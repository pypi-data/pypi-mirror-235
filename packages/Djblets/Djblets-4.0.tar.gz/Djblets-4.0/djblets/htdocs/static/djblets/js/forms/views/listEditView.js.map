{"version":3,"file":"listEditView.js","names":["entryTemplate","_","template","Djblets","Forms","ListEditView","Backbone","View","extend","events","initialize","options","_removeText","removeText","_fieldName","fieldName","_renderedDefaultRow","renderedDefaultRow","_numItems","render","$el","data","_$list","children","find","length","$","val","_$addBtn","_createDefaultEntry","index","$entry","_updateEntryInputName","on","e","_addItem","$inputs","each","idx","el","attr","preventDefault","stopPropagation","append","_removeItem","$target","target","closest","remove","$defaultEntry","replaceWith"],"sources":["../../../../../../static/djblets/js/forms/views/listEditView.es6.js"],"sourcesContent":["(function() {\n\n\nconst entryTemplate = _.template(dedent`\n    <li class=\"djblets-c-list-edit-widget__entry\"\n        data-list-index=\"<%- index %>\">\n      <%= renderedDefaultRow %>\n     <a href=\"#\" class=\"djblets-c-list-edit-widget__remove-item\"\n        role=\"button\" title=\"<%- removeText %>\">\n       <span class=\"fa fa-times\"></span>\n     </a>\n    </li>\n`);\n\n/**\n * A view for editing a list of elements.\n *\n * This is the JavaScript view for\n * :py:class:`djblets.forms.widgets.ListEditWidget`.\n */\nDjblets.Forms.ListEditView = Backbone.View.extend({\n    events: {\n        'click .djblets-c-list-edit-widget__add-item': '_addItem',\n        'click .djblets-c-list-edit-widget__remove-item': '_removeItem',\n    },\n\n    /**\n     * Initialize the view.\n     *\n     * Version Changed:\n     *     3.0:\n     *     * Removed the `inputAttrs` option.\n     *     * Removed the `sep` option.\n     *     * Added the `fieldName` option.\n     *     * Added the `renderedDefaultRow` option.\n     *\n     * Args:\n     *     options (object):\n     *         The view options.\n     *\n     * Option Args:\n     *     removeText (string):\n     *         The localized text for removing an item.\n     *\n     *     fieldName (string):\n     *         The form field name corresponding to this ListEditWidget.\n     *\n     *     renderedDefaultRow (string):\n     *         The HTML for a default item in the list. This is used to\n     *         render a default item when adding a new item to the list.\n     */\n    initialize(options) {\n        this._removeText = options.removeText;\n        this._fieldName = options.fieldName;\n        this._renderedDefaultRow = options.renderedDefaultRow;\n        this._numItems = 0;\n\n    },\n\n    /**\n     * Render the view.\n     *\n     * Since most of the view is rendered by Django, this just sets up some\n     * event listeners.\n     *\n     * Returns:\n     *     Djblets.Forms.ListEditView:\n     *     This view.\n     */\n    render() {\n        this.$el.data('djblets-list-edit-view', this);\n\n        this._$list = this.$el.children(\n            '.djblets-c-list-edit-widget__entries');\n        this._numItems =\n            this._$list.find('.djblets-c-list-edit-widget__entry').length;\n        $(`input[name=\"${this._fieldName}_num_rows\"]`).val(this._numItems);\n        this._$addBtn = this.$el.children(\n            '.djblets-c-list-edit-widget__add-item');\n\n        return this;\n    },\n\n    /**\n     * Create and format the HTML for a new entry in the list.\n     *\n     * Args:\n     *     index (int):\n     *         The index of the new entry in the list of entries.\n     *\n     * Returns:\n     *     jQuery:\n     *     The HTML for the new entry in the list.\n     */\n    _createDefaultEntry(index) {\n        const $entry = $(entryTemplate({\n            index: index,\n            removeText: this._removeText,\n            renderedDefaultRow: this._renderedDefaultRow,\n        }));\n        this._updateEntryInputName($entry, index);\n\n        $(`input[name=\"${this._fieldName}_num_rows\"]`).val(index+1);\n        $entry.find('.djblets-c-list-edit-widget__add-item')\n            .on('click', e => this._addItem(e));\n\n        return $entry;\n    },\n\n    /**\n     * Update the name(s) of the entry's .djblets-c-list-edit-widget__input(s)\n     * so that they contain the appropriate index for the entry.\n     *\n     * Args:\n     *     $entry (jQuery):\n     *         The entry to update.\n     *\n     *     index (int):\n     *         The index of the entry in the list of entries.\n     */\n    _updateEntryInputName($entry, index) {\n        const $inputs = $entry.find('.djblets-c-list-edit-widget__input');\n\n        // The entry may have more than one \"input\".\n        if ($inputs.length > 1) {\n            $inputs.each((idx, el) =>\n                $(el).attr('name',\n                           `${this._fieldName}_value[${index}]_${idx}`));\n        } else {\n            $inputs.attr('name', `${this._fieldName}_value[${index}]`);\n        }\n    },\n\n    /**\n     * Add an item to the list.\n     *\n     * Args:\n     *     e (Event):\n     *         The click event that triggered this event handler.\n     */\n    _addItem(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this._$list.append(this._createDefaultEntry(this._numItems));\n        this._numItems += 1;\n    },\n\n    /**\n     * Remove an item.\n     *\n     * When there is only a single item in the list, we clear it instead of\n     * removing it so there is always at least one item in the list.\n     *\n     * Args:\n     *     e (Event):\n     *         The click event that triggered this event handler.\n     */\n    _removeItem(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $target = $(e.target);\n        const $entry = $target.closest('.djblets-c-list-edit-widget__entry');\n\n        if (this._numItems > 1) {\n            $entry.remove();\n            this._numItems -= 1;\n            this._$list.find('.djblets-c-list-edit-widget__entry')\n                .each((idx, el) => {\n                    const $el = $(el);\n                    $el.attr('data-list-index', idx);\n                    this._updateEntryInputName($el, idx);\n                });\n            $(`input[name=\"${this._fieldName}_num_rows\"]`)\n                .val(this._numItems);\n        } else {\n            const $defaultEntry = this._createDefaultEntry(0);\n            $entry.replaceWith($defaultEntry);\n        }\n    },\n});\n\n\n})();\n"],"mappings":"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"}