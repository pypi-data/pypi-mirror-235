{"version":3,"file":"extensionManagerView.js","names":["ExtensionItem","Djblets","Config","ListItem","extend","defaults","_","extension","prototype","initialize","apply","arguments","_updateActions","_updateItemState","listenTo","get","actions","push","id","label","configURL","dbURL","url","primary","danger","setActions","itemState","set","ExtensionItemView","TableItemView","className","actionHandlers","template","getRenderContext","model","attributes","_onDisableClicked","disable","catch","error","alert","message","_onEnableClicked","enable","_onReloadClicked","Promise","trigger","ExtensionManagerView","Backbone","View","events","listItemType","listItemViewType","listItemsCollectionType","ListItems","listViewType","TableView","list","List","collection","render","listView","ItemView","el","$","$el","removeAttr","addClass","_$listContainer","parent","reset","_onLoaded","load","items","installedExtensions","each","item","add","_reloadFull","submit"],"sources":["../../../../../../static/djblets/js/extensions/views/extensionManagerView.es6.js"],"sourcesContent":["(function() {\n\n\n/**\n * An item in the list of registered extensions.\n *\n * This will contain information on the extension and actions for toggling\n * the enabled state, reloading the extension, or configuring the extension.\n */\nconst ExtensionItem = Djblets.Config.ListItem.extend({\n    defaults: _.defaults({\n        extension: null,\n    }, Djblets.Config.ListItem.prototype.defaults),\n\n    /**\n     * Initialize the item.\n     *\n     * This will set up the initial state and then listen for any changes\n     * to the extension's state (caused by enabling/disabling/reloading the\n     * extension).\n     */\n    initialize() {\n        Djblets.Config.ListItem.prototype.initialize.apply(this, arguments);\n\n        this._updateActions();\n        this._updateItemState();\n\n        this.listenTo(\n            this.get('extension'),\n            'change:loadable change:loadError change:enabled',\n            () => {\n                this._updateItemState();\n                this._updateActions();\n            });\n    },\n\n    /**\n     * Update the actions for the extension.\n     *\n     * If the extension is disabled, this will add an Enabled action.\n     *\n     * If it's enabled, but has a load error, it will add a Reload action.\n     *\n     * If it's enabled, it will provide actions for Configure and Database,\n     * if enabled by the extension, along with a Disable action.\n     */\n    _updateActions() {\n        const extension = this.get('extension');\n        const actions = [];\n\n        if (!extension.get('loadable')) {\n            /* Add an action for reloading the extension. */\n            actions.push({\n                id: 'reload',\n                label: _`Reload`,\n            });\n        } else if (extension.get('enabled')) {\n            /*\n             * Show all the actions for enabled extensions.\n             *\n             * Note that the order used is here to ensure visual alignment\n             * for most-frequently-used options.\n             */\n            const configURL = extension.get('configURL');\n            const dbURL = extension.get('dbURL');\n\n            if (dbURL) {\n                actions.push({\n                    id: 'database',\n                    label: _`Database`,\n                    url: dbURL,\n                });\n            }\n\n            if (configURL) {\n                actions.push({\n                    id: 'configure',\n                    label: _`Configure`,\n                    primary: true,\n                    url: configURL,\n                });\n            }\n\n            actions.push({\n                danger: true,\n                id: 'disable',\n                label: _`Disable`,\n            });\n        } else {\n            /* Add an action for enabling a disabled extension. */\n            actions.push({\n                id: 'enable',\n                label: _`Enable`,\n                primary: true,\n            });\n        }\n\n        this.setActions(actions);\n    },\n\n    /**\n     * Update the state of this item.\n     *\n     * This will set the \"error\", \"enabled\", or \"disabled\" state of the\n     * item, depending on the corresponding state in the extension.\n     */\n    _updateItemState() {\n        const extension = this.get('extension');\n        let itemState;\n\n        if (!extension.get('loadable')) {\n            itemState = 'error';\n        } else if (extension.get('enabled')) {\n            itemState = 'enabled';\n        } else {\n            itemState = 'disabled';\n        }\n\n        this.set('itemState', itemState);\n    },\n});\n\n\n/**\n * Displays an extension in the Manage Extensions list.\n *\n * This will show information about the extension, and provide links for\n * enabling/disabling the extension, and (depending on the extension's\n * capabilities) configuring it or viewing its database.\n */\nconst ExtensionItemView = Djblets.Config.TableItemView.extend({\n    className: 'djblets-c-extension-item djblets-c-config-forms-list__item',\n\n    actionHandlers: {\n        'disable': '_onDisableClicked',\n        'enable': '_onEnableClicked',\n        'reload': '_onReloadClicked',\n    },\n\n    template: _.template(dedent`\n        <td class=\"djblets-c-config-forms-list__item-main\">\n         <div class=\"djblets-c-extension-item__header\">\n          <h3 class=\"djblets-c-extension-item__name\"><%- name %></h3>\n          <span class=\"djblets-c-extension-item__version\"><%- version %></span>\n          <div class=\"djblets-c-extension-item__author\">\n           <% if (authorURL) { %>\n            <a href=\"<%- authorURL %>\"><%- author %></a>\n           <% } else { %>\n            <%- author %>\n           <% } %>\n          </div>\n         </div>\n         <p class=\"djblets-c-extension-item__description\">\n          <%- summary %>\n         </p>\n         <% if (!loadable) { %>\n          <pre class=\"djblets-c-extension-item__load-error\"><%-\n            loadError %></pre>\n         <% } %>\n        </td>\n        <td class=\"djblets-c-config-forms-list__item-state\"></td>\n        <td></td>\n    `),\n\n    /**\n     * Return context data for rendering the item's template.\n     *\n     * Returns:\n     *     object:\n     *     Context data for the render.\n     */\n    getRenderContext() {\n        return this.model.get('extension').attributes;\n    },\n\n    /**\n     * Handle a click on the Disable action.\n     *\n     * This will make an asynchronous request to disable the extension.\n     *\n     * Returns:\n     *     Promise:\n     *     A promise for the disable request. This will resolve once the\n     *     API has handled the request.\n     */\n    _onDisableClicked() {\n        return this.model.get('extension').disable()\n            .catch(error => {\n                alert(_`Failed to disable the extension: ${error.message}.`);\n            });\n    },\n\n    /**\n     * Handle a click on the Enable action.\n     *\n     * This will make an asynchronous request to enable the extension.\n     *\n     * Returns:\n     *     Promise:\n     *     A promise for the enable request. This will resolve once the\n     *     API has handled the request.\n     */\n    _onEnableClicked() {\n        return this.model.get('extension').enable()\n            .catch(error => {\n                alert(_`Failed to enable the extension: ${error.message}.`);\n            });\n    },\n\n    /**\n     * Handle a click on the Reload action.\n     *\n     * This will trigger an event on the item that tells the extension\n     * manager to perform a full reload of all extensions, this one included.\n     *\n     * Returns:\n     *     Promise:\n     *     A promise for the enable request. This will never resolve, in\n     *     practice, but is returned to enable the action's spinner until\n     *     the page reloads.\n     */\n    _onReloadClicked() {\n        return new Promise(() => this.model.trigger('needsReload'));\n    },\n});\n\n\n/**\n * Displays the interface showing all installed extensions.\n *\n * This loads the list of installed extensions and displays each in a list.\n */\nDjblets.ExtensionManagerView = Backbone.View.extend({\n    events: {\n        'click .djblets-c-extensions__reload': '_reloadFull',\n    },\n\n    listItemType: ExtensionItem,\n    listItemViewType: ExtensionItemView,\n    listItemsCollectionType: Djblets.Config.ListItems,\n    listViewType: Djblets.Config.TableView,\n\n    /**\n     * Initialize the view.\n     */\n    initialize() {\n        this.list = new Djblets.Config.List(\n            {},\n            {\n                collection: new this.listItemsCollectionType(\n                    [],\n                    {\n                        model: this.listItemType,\n                    }),\n            });\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     Djblets.ExtensionManagerView:\n     *     This object, for chaining.\n     */\n    render() {\n        const model = this.model;\n        const list = this.list;\n\n        this.listView = new this.listViewType({\n            ItemView: this.listItemViewType,\n            el: this.$('.djblets-c-config-forms-list'),\n            model: list,\n        });\n        this.listView.render().$el\n            .removeAttr('aria-busy')\n            .addClass('-all-items-are-multiline');\n\n        this._$listContainer = this.listView.$el.parent();\n\n        this.listenTo(model, 'loading', () => list.collection.reset());\n        this.listenTo(model, 'loaded', this._onLoaded);\n        model.load();\n\n        return this;\n    },\n\n    /**\n     * Handler for when the list of extensions is loaded.\n     *\n     * Renders each extension in the list. If the list is empty, this will\n     * display that there are no extensions installed.\n     */\n    _onLoaded() {\n        const items = this.list.collection;\n\n        this.model.installedExtensions.each(extension => {\n            const item = items.add({\n                extension: extension,\n            });\n\n            this.listenTo(item, 'needsReload', this._reloadFull);\n        });\n    },\n\n    /**\n     * Perform a full reload of the list of extensions on the server.\n     *\n     * This submits our form, which is set in the template to tell the\n     * ExtensionManager to do a full reload.\n     */\n    _reloadFull() {\n        this.el.submit();\n    },\n});\n\n\n})();\n"],"mappings":"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"}