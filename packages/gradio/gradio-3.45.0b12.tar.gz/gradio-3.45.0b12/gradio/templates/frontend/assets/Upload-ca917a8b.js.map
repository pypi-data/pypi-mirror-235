{"version":3,"file":"Upload-ca917a8b.js","sources":["../../../../js/upload/src/Upload.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { createEventDispatcher, tick, getContext } from \"svelte\";\n\timport type { FileData } from \"./types\";\n\timport { blobToBase64, normalise_file } from \"./utils\";\n\timport { upload_files as default_upload_files } from \"@gradio/client\";\n\n\tconst upload_files =\n\t\tgetContext<typeof default_upload_files>(\"upload_files\") ??\n\t\tdefault_upload_files;\n\n\texport let filetype: string | null = null;\n\texport let dragging = false;\n\texport let boundedheight = true;\n\texport let center = true;\n\texport let flex = true;\n\texport let file_count = \"single\";\n\texport let disable_click = false;\n\texport let root: string;\n\n\tlet hidden_upload: HTMLInputElement;\n\n\tconst dispatch = createEventDispatcher();\n\n\tfunction updateDragging(): void {\n\t\tdragging = !dragging;\n\t}\n\n\tfunction openFileUpload(): void {\n\t\tif (disable_click) return;\n\t\thidden_upload.value = \"\";\n\t\thidden_upload.click();\n\t}\n\n\tasync function handle_upload(file_data: FileData[]): Promise<void> {\n\t\tawait tick();\n\t\tlet files = (Array.isArray(file_data) ? file_data : [file_data]).map(\n\t\t\t(file_data) => file_data.blob!\n\t\t);\n\n\t\tawait upload_files(root, files).then(async (response) => {\n\t\t\tif (response.error) {\n\t\t\t\t(Array.isArray(file_data) ? file_data : [file_data]).forEach(\n\t\t\t\t\tasync (file_data, i) => {\n\t\t\t\t\t\tfile_data.data = await blobToBase64(file_data.blob!);\n\t\t\t\t\t\tfile_data.blob = undefined;\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t(Array.isArray(file_data) ? file_data : [file_data]).forEach((f, i) => {\n\t\t\t\t\tif (response.files) {\n\t\t\t\t\t\tf.orig_name = f.name;\n\t\t\t\t\t\tf.name = response.files[i];\n\t\t\t\t\t\tf.is_file = true;\n\t\t\t\t\t\tf.blob = undefined;\n\t\t\t\t\t\tnormalise_file(f, root, null);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tdispatch(\"load\", file_count === \"single\" ? file_data[0] : file_data);\n\t}\n\n\tasync function loadFiles(files: FileList): Promise<void> {\n\t\tlet _files: File[] = Array.from(files);\n\t\tif (!files.length) {\n\t\t\treturn;\n\t\t}\n\t\tif (file_count === \"single\") {\n\t\t\t_files = [files[0]];\n\t\t}\n\t\tvar all_file_data: FileData[] = [];\n\t\t_files.forEach((f, i) => {\n\t\t\tall_file_data[i] = {\n\t\t\t\tname: f.name,\n\t\t\t\tsize: f.size,\n\t\t\t\tdata: \"\",\n\t\t\t\tblob: f\n\t\t\t};\n\t\t});\n\t\tawait handle_upload(all_file_data);\n\t}\n\n\tasync function loadFilesFromUpload(e: Event): Promise<void> {\n\t\tconst target = e.target as HTMLInputElement;\n\n\t\tif (!target.files) return;\n\t\tawait loadFiles(target.files);\n\t}\n\n\tasync function loadFilesFromDrop(e: DragEvent): Promise<void> {\n\t\tdragging = false;\n\t\tif (!e.dataTransfer?.files) return;\n\t\tawait loadFiles(e.dataTransfer.files);\n\t}\n</script>\n\n<button\n\tclass:center\n\tclass:boundedheight\n\tclass:flex\n\ton:drag|preventDefault|stopPropagation\n\ton:dragstart|preventDefault|stopPropagation\n\ton:dragend|preventDefault|stopPropagation\n\ton:dragover|preventDefault|stopPropagation\n\ton:dragenter|preventDefault|stopPropagation\n\ton:dragleave|preventDefault|stopPropagation\n\ton:drop|preventDefault|stopPropagation\n\ton:click={openFileUpload}\n\ton:drop={loadFilesFromDrop}\n\ton:dragenter={updateDragging}\n\ton:dragleave={updateDragging}\n>\n\t<slot />\n\t<input\n\t\ttype=\"file\"\n\t\tbind:this={hidden_upload}\n\t\ton:change={loadFilesFromUpload}\n\t\taccept={filetype}\n\t\tmultiple={file_count === \"multiple\" || undefined}\n\t\twebkitdirectory={file_count === \"directory\" || undefined}\n\t\tmozdirectory={file_count === \"directory\" || undefined}\n\t/>\n</button>\n\n<style>\n\tbutton {\n\t\tcursor: pointer;\n\t\twidth: var(--size-full);\n\t\theight: var(--size-full);\n\t}\n\n\t.center {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t}\n\t.flex {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t}\n\n\tinput {\n\t\tdisplay: none;\n\t}\n</style>\n"],"names":["createEventDispatcher","tick","getContext","ctx","insert","target","button","anchor","append","input","upload_files","default_upload_files","filetype","$$props","dragging","boundedheight","center","flex","file_count","disable_click","root","hidden_upload","dispatch","updateDragging","$$invalidate","openFileUpload","handle_upload","file_data","files","response","i","blobToBase64","f","normalise_file","loadFiles","_files","all_file_data","loadFilesFromUpload","loadFilesFromDrop","$$value"],"mappings":"ybACU,CAAA,sBAAAA,GAAuB,KAAAC,GAAM,WAAAC,EAAA,SAA0B,gMAoHvDC,EAAQ,CAAA,CAAA,eACNA,EAAU,CAAA,IAAK,YAAc,+BACtBA,EAAU,CAAA,IAAK,aAAe,MAAS,uBAC1CA,EAAU,CAAA,IAAK,aAAe,MAAS,kIAxBvDC,EA0BQC,EAAAC,EAAAC,CAAA,wBATPC,EAQCF,EAAAG,CAAA,oCALWN,EAAmB,CAAA,CAAA,4MATrBA,EAAc,CAAA,CAAA,aACfA,EAAiB,CAAA,CAAA,kBACZA,EAAc,CAAA,CAAA,kBACdA,EAAc,CAAA,CAAA,mHAOnBA,EAAQ,CAAA,CAAA,oBACNA,EAAU,CAAA,IAAK,YAAc,2CACtBA,EAAU,CAAA,IAAK,aAAe,qDACjCA,EAAU,CAAA,IAAK,aAAe,4QAlHvC,MAAAO,EACLR,GAAwC,cAAc,GACtDS,EAEU,GAAA,CAAA,SAAAC,EAA0B,IAAI,EAAAC,EAC9B,CAAA,SAAAC,EAAW,EAAK,EAAAD,EAChB,CAAA,cAAAE,EAAgB,EAAI,EAAAF,EACpB,CAAA,OAAAG,EAAS,EAAI,EAAAH,EACb,CAAA,KAAAI,EAAO,EAAI,EAAAJ,EACX,CAAA,WAAAK,EAAa,QAAQ,EAAAL,EACrB,CAAA,cAAAM,EAAgB,EAAK,EAAAN,GACrB,KAAAO,CAAY,EAAAP,EAEnBQ,EAEE,MAAAC,EAAWtB,cAERuB,GAAc,CACtBC,EAAA,GAAAV,GAAYA,CAAQ,WAGZW,GAAc,CAClBN,QACJE,EAAc,MAAQ,GAAEA,CAAA,EACxBA,EAAc,MAAK,GAGL,eAAAK,EAAcC,EAAqB,OAC3C1B,GAAI,EACN,IAAA2B,GAAS,MAAM,QAAQD,CAAS,EAAIA,EAAa,CAAAA,CAAS,GAAG,IAC/DA,GAAcA,EAAU,IAAK,EAGzB,MAAAjB,EAAaU,EAAMQ,CAAK,EAAE,WAAYC,GAAQ,CAC/CA,EAAS,OACX,MAAM,QAAQF,CAAS,EAAIA,EAAa,CAAAA,CAAS,GAAG,QAC7C,MAAAA,EAAWG,IAAC,CAClBH,EAAU,KAAI,MAASI,EAAaJ,EAAU,IAAK,EACnDA,EAAU,KAAO,UAIlB,MAAM,QAAQA,CAAS,EAAIA,EAAa,CAAAA,CAAS,GAAG,QAAS,CAAAK,EAAGF,IAAC,CAC7DD,EAAS,QACZG,EAAE,UAAYA,EAAE,KAChBA,EAAE,KAAOH,EAAS,MAAMC,CAAC,EACzBE,EAAE,QAAU,GACZA,EAAE,KAAO,OACTC,EAAeD,EAAGZ,EAAM,IAAI,OAKhCE,EAAS,OAAQJ,IAAe,SAAWS,EAAU,CAAC,EAAIA,CAAS,EAGrD,eAAAO,EAAUN,EAAe,CACnC,IAAAO,EAAiB,MAAM,KAAKP,CAAK,EAChC,GAAAA,EAAM,OAGP,CAAAV,IAAe,WAClBiB,EAAM,CAAIP,EAAM,CAAC,CAAA,OAEdQ,EAAa,CAAA,EACjBD,EAAO,QAAS,CAAAH,EAAGF,IAAC,CACnBM,EAAcN,CAAC,EAAA,CACd,KAAME,EAAE,KACR,KAAMA,EAAE,KACR,KAAM,GACN,KAAMA,KAGF,MAAAN,EAAcU,CAAa,GAGnB,eAAAC,EAAoB,EAAQ,OACpChC,EAAS,EAAE,OAEZA,EAAO,aACN6B,EAAU7B,EAAO,KAAK,EAGd,eAAAiC,EAAkB,EAAY,CAC5Cd,EAAA,GAAAV,EAAW,EAAK,EACX,EAAE,cAAc,OACf,MAAAoB,EAAU,EAAE,aAAa,KAAK,oQAuBzBb,EAAakB"}