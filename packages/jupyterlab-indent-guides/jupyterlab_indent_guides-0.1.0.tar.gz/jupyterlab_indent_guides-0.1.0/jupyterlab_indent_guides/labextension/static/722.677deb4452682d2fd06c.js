"use strict";(self.webpackChunkjupyterlab_indent_guides=self.webpackChunkjupyterlab_indent_guides||[]).push([[722],{722:(t,e,n)=>{n.r(e),n.d(e,{indentationMarkers:()=>f});var i=n(373),s=n(204),r=n(211);function o(t){const e=t.selection.main.head;return t.doc.lineAt(e)}function l(t,e){let n=0;t:for(let i=0;i<t.length;i++)switch(t[i]){case" ":n+=1;continue t;case"\t":n+=e-n%e;continue t;case"\r":continue t;default:break t}return n}const c=s.Facet.define({combine:t=>(0,s.combineConfig)(t,{highlightActiveBlock:!0,hideFirstIndent:!1,markerType:"fullScope",thickness:1})});class a{constructor(t,e,n,i){this.lines=t,this.state=e,this.map=new Map,this.unitWidth=n,this.markerType=i;for(const t of this.lines)this.add(t);this.state.facet(c).highlightActiveBlock&&this.findAndSetActiveLines()}has(t){return this.map.has("number"==typeof t?t:t.number)}get(t){const e=this.map.get("number"==typeof t?t:t.number);if(!e)throw new Error("Line not found in indentation map");return e}set(t,e,n){const i=!t.text.trim().length,s={line:t,col:e,level:n,empty:i};return this.map.set(s.line.number,s),s}add(t){if(this.has(t))return this.get(t);if(!t.length||!t.text.trim().length){if(1===t.number)return this.set(t,0,0);if(t.number===this.state.doc.lines){const e=this.closestNonEmpty(t,-1);return this.set(t,0,e.level)}const e=this.closestNonEmpty(t,-1),n=this.closestNonEmpty(t,1);return e.level>=n.level&&"codeOnly"!==this.markerType?this.set(t,0,e.level):e.empty&&0===e.level&&0!==n.level?this.set(t,0,0):n.level>e.level?this.set(t,0,e.level+1):this.set(t,0,n.level)}const e=l(t.text,this.state.tabSize),n=Math.floor(e/this.unitWidth);return this.set(t,e,n)}closestNonEmpty(t,e){let n=t.number+e;for(;-1===e?n>=1:n<=this.state.doc.lines;){if(this.has(n)){const t=this.get(n);if(!t.empty)return t}const t=this.state.doc.line(n);if(t.text.trim().length){const e=l(t.text,this.state.tabSize),n=Math.floor(e/this.unitWidth);return this.set(t,e,n)}n+=e}const i=this.state.doc.line(-1===e?1:this.state.doc.lines);return this.set(i,0,0)}findAndSetActiveLines(){const t=o(this.state);if(!this.has(t))return;let e,n,i=this.get(t);if(this.has(i.line.number+1)){const t=this.get(i.line.number+1);t.level>i.level&&(i=t)}if(this.has(i.line.number-1)){const t=this.get(i.line.number-1);t.level>i.level&&(i=t)}if(0!==i.level){for(i.active=i.level,e=i.line.number;e>1;e--){if(!this.has(e-1))continue;const t=this.get(e-1);if(t.level<i.level)break;t.active=i.level}for(n=i.line.number;n<this.state.doc.lines;n++){if(!this.has(n+1))continue;const t=this.get(n+1);if(t.level<i.level)break;t.active=i.level}}}}function h(t){const e={light:"#F0F1F2",dark:"#2B3245",activeLight:"#E4E5E6",activeDark:"#3C445C"};let n=e;return t&&(n=Object.assign(Object.assign({},e),t)),r.EditorView.baseTheme({"&light":{"--indent-marker-bg-color":n.light,"--indent-marker-active-bg-color":n.activeLight},"&dark":{"--indent-marker-bg-color":n.dark,"--indent-marker-active-bg-color":n.activeDark},".cm-line":{position:"relative"},".cm-indent-markers::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:"var(--indent-markers)",pointerEvents:"none",zIndex:"-1"}})}function u(t,e,n,i,s){return`repeating-linear-gradient(to right, var(${t}) 0 ${e}px, transparent ${e}px ${n}ch) ${i*n}.5ch/calc(${n*s}ch - 1px) no-repeat`}function d(t,e,n,i){const{level:s,active:r}=t;if(n&&0===s)return[];const o=n?1:0,l=[];if(void 0!==r){const t=r-o-1;t>0&&l.push(u("--indent-marker-bg-color",i,e,o,t)),l.push(u("--indent-marker-active-bg-color",i,e,r-1,1)),r!==s&&l.push(u("--indent-marker-bg-color",i,e,r,s-r))}else l.push(u("--indent-marker-bg-color",i,e,o,s-o));return l.join(",")}class m{constructor(t){this.view=t,this.unitWidth=(0,i.getIndentUnit)(t.state),this.currentLineNumber=o(t.state).number,this.generate(t.state)}update(t){const e=(0,i.getIndentUnit)(t.state),n=e!==this.unitWidth;n&&(this.unitWidth=e);const s=o(t.state).number,r=s!==this.currentLineNumber;this.currentLineNumber=s;const l=t.state.facet(c).highlightActiveBlock&&r;(t.docChanged||t.viewportChanged||n||l)&&this.generate(t.state)}generate(t){const e=new s.RangeSetBuilder,n=function(t,e=t.state){const n=new Set;for(const{from:i,to:s}of t.visibleRanges){let t=i;for(;t<=s;){const i=e.doc.lineAt(t);n.has(i)||n.add(i),t=i.to+1}}return n}(this.view,t),{hideFirstIndent:i,markerType:o,thickness:l}=t.facet(c),h=new a(n,t,this.unitWidth,o);for(const t of n){const n=h.get(t.number);if(!(null==n?void 0:n.level))continue;const s=d(n,this.unitWidth,i,l);e.add(t.from,t.from,r.Decoration.line({class:"cm-indent-markers",attributes:{style:`--indent-markers: ${s}`}}))}this.decorations=e.finish()}}function f(t={}){return[c.of(t),h(t.colors),r.ViewPlugin.fromClass(m,{decorations:t=>t.decorations})]}}}]);