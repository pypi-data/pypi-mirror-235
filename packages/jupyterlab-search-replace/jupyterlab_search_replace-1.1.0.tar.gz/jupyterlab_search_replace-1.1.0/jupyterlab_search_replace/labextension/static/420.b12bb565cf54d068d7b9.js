"use strict";(self.webpackChunkjupyterlab_search_replace=self.webpackChunkjupyterlab_search_replace||[]).push([[420],{420:(e,t,a)=>{a.r(t),a.d(t,{default:()=>P});var r=a(993),l=a(779),s=a(861),n=a(679),i=a(854),c=a(261),o=a(684),h=a(505),u=a(800),p=a(930),d=a(797),m=a(614),g=a(788);async function _(e="",t={}){const a=g.ServerConnection.makeSettings(),r=m.URLExt.join(a.baseUrl,"search",e);let l;try{l=await g.ServerConnection.makeRequest(r,t,a)}catch(e){throw new g.ServerConnection.NetworkError(e)}let s=await l.text();if(s.length>0)try{s=JSON.parse(s)}catch(e){console.log("Not a JSON response body.",l)}if(!l.ok)throw new g.ServerConnection.ResponseError(l,s.message||s);return s}const f=/\$[1-9]\d*/g;class v extends s.VDomModel{constructor(){super(),this._errorMsg=null,this._isLoading=!1,this._searchQuery="",this._queryResults=[],this._caseSensitive=!1,this._wholeWord=!1,this._useRegex=!1,this._excludeFilters="",this._includeFilters="",this._path="",this._replaceString="",this._replaceWorker=null,this._defaultExcludeFilters=[],this._maxLinesPerFile=100,this._debouncedSearch=new d.Debouncer((async()=>{await this.search()}))}get caseSensitive(){return this._caseSensitive}set caseSensitive(e){e!==this._caseSensitive&&(this._caseSensitive=e,this.stateChanged.emit(),this.refresh())}get defaultExcludeFilters(){return this._defaultExcludeFilters}set defaultExcludeFilters(e){p.JSONExt.deepEqual(e,this._defaultExcludeFilters)||(this._defaultExcludeFilters=e,this.stateChanged.emit(),this.refresh())}get error(){return this._errorMsg}get excludeFilters(){return this._excludeFilters}set excludeFilters(e){e!==this._excludeFilters&&(this._excludeFilters=e,this.stateChanged.emit(),this.refresh())}get includeFilters(){return this._includeFilters}set includeFilters(e){e!==this._includeFilters&&(this._includeFilters=e,this.stateChanged.emit(),this.refresh())}get isLoading(){return this._isLoading}set isLoading(e){e!==this._isLoading&&(this._isLoading=e,this.stateChanged.emit())}get path(){return this._path}set path(e){e!==this._path&&(this._path=e,this.stateChanged.emit(),this.refresh())}get queryResults(){return this._queryResults}get maxLinesPerFile(){return this._maxLinesPerFile}set maxLinesPerFile(e){e>=1&&e!==this._maxLinesPerFile&&(this._maxLinesPerFile=e,this.stateChanged.emit(),this.refresh())}get replaceString(){return this._replaceString}set replaceString(e){e!==this._replaceString&&(this._replaceString=e,this.stateChanged.emit(),this._updateReplace().then((()=>{this.stateChanged.emit()})).catch((e=>{console.error(`Failed to update replace expression.\n${e}`)})))}get searchQuery(){return this._searchQuery}set searchQuery(e){e!==this._searchQuery&&(this._searchQuery=e,this.stateChanged.emit(),this.refresh())}get useRegex(){return this._useRegex}set useRegex(e){e!==this._useRegex&&(this._useRegex=e,this.stateChanged.emit(),this.refresh())}get wholeWord(){return this._wholeWord}set wholeWord(e){e!==this._wholeWord&&(this._wholeWord=e,this.stateChanged.emit(),this.refresh())}refresh(){this._debouncedSearch.invoke().catch((e=>console.error(`Failed to invoke search.\n${e}`)))}async replace(e){var t;try{await _(this.path,{method:"POST",body:JSON.stringify({matches:e})}),this._errorMsg=null}catch(e){console.error(`Failed to replace some matches.\n${e}`),this._errorMsg=null!==(t=e.message)&&void 0!==t?t:e}finally{this.refresh()}}async search(){var e;const t=this.searchQuery,a=this.path;if(""===t)return this._errorMsg=null,this._queryResults=[],this.stateChanged.emit(),Promise.resolve();try{this.isLoading=!0;const e=[["query",t],["case_sensitive",this.caseSensitive.toString()],["whole_word",this.wholeWord.toString()],["use_regex",this.useRegex.toString()],["max_count",this.maxLinesPerFile.toString()]];e.push(...this.excludeFilters.split(",").concat(this.defaultExcludeFilters).map((e=>e.trim())).filter((e=>e)).map((e=>["exclude",e]))),e.push(...this.includeFilters.split(",").map((e=>e.trim())).filter((e=>e)).map((e=>["include",e])));const r=await _(a+"?"+new URLSearchParams(e).toString(),{method:"GET"});this._queryResults=r.matches,this._errorMsg=null,this.replaceString&&await this._updateReplace()}catch(r){console.error(`Failed to search for '${t}' in '${a}'.`,r),this._errorMsg=null!==(e=r.message)&&void 0!==e?e:r,this._queryResults=[]}finally{this._isLoading=!1,this.stateChanged.emit()}}async _updateReplace(){const e=(e=null)=>{this._queryResults.forEach((t=>{t.matches.forEach((t=>{t.replace=e}))}))};if(null===this.replaceString.match(f))e(this.replaceString?this.replaceString:null);else{window.Worker||(console.error("Failed to build complex replacement expression because your browser does not support WebWorker."),e()),this._replaceWorker&&this._replaceWorker.terminate(),this._replaceWorker=new Worker(new URL(a.p+a.u(641),a.b));const t=new p.PromiseDelegate;this._replaceWorker.onerror=e=>{t.reject(e)},this._replaceWorker.onmessage=e=>{this._queryResults=e.data,t.resolve()},this._replaceWorker.postMessage([this.searchQuery,this.caseSensitive?"":"i",this.replaceString,this.queryResults]);try{await t.promise}catch(t){console.error(`Failed to build complex replacement expression.\n${t}`),e()}finally{this._replaceWorker.terminate(),this._replaceWorker=null}}}}var w=a(204),x=a(537),C=a(29),E=a.n(C),y=a(778);class S extends y.Widget{constructor(e,t){super({node:S.createNode(e,t)}),this._checkbox=this.node.querySelector('.jp-ask-checkbox > input[type="checkbox"]')}getValue(){return this._checkbox.checked}static createNode(e,t){const a=document.createElement("div");return a.insertAdjacentHTML("afterbegin",`<div><p>${e}</p></div>\n      <label class="jp-ask-checkbox"><input type="checkbox"></input>${t}</label>`),a}}const R=new u.LabIcon({name:"search-replace:wholeWord",svgstr:'<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 11H1V13H15V11H16V14H15H1H0V11Z"/><path d="M6.84048 11H5.95963V10.1406H5.93814C5.555 10.7995 4.99104 11.1289 4.24625 11.1289C3.69839 11.1289 3.26871 10.9839 2.95718 10.6938C2.64924 10.4038 2.49527 10.0189 2.49527 9.53906C2.49527 8.51139 3.10041 7.91341 4.3107 7.74512L5.95963 7.51416C5.95963 6.57959 5.58186 6.1123 4.82632 6.1123C4.16389 6.1123 3.56591 6.33789 3.03238 6.78906V5.88672C3.57307 5.54297 4.19612 5.37109 4.90152 5.37109C6.19416 5.37109 6.84048 6.05501 6.84048 7.42285V11ZM5.95963 8.21777L4.63297 8.40039C4.22476 8.45768 3.91682 8.55973 3.70914 8.70654C3.50145 8.84977 3.39761 9.10579 3.39761 9.47461C3.39761 9.74316 3.4925 9.96338 3.68228 10.1353C3.87564 10.3035 4.13166 10.3877 4.45035 10.3877C4.8872 10.3877 5.24706 10.2355 5.52994 9.93115C5.8164 9.62321 5.95963 9.2347 5.95963 8.76562V8.21777Z"/><path d="M9.3475 10.2051H9.32601V11H8.44515V2.85742H9.32601V6.4668H9.3475C9.78076 5.73633 10.4146 5.37109 11.2489 5.37109C11.9543 5.37109 12.5057 5.61816 12.9032 6.1123C13.3042 6.60286 13.5047 7.26172 13.5047 8.08887C13.5047 9.00911 13.2809 9.74674 12.8333 10.3018C12.3857 10.8532 11.7734 11.1289 10.9964 11.1289C10.2695 11.1289 9.71989 10.821 9.3475 10.2051ZM9.32601 7.98682V8.75488C9.32601 9.20964 9.47282 9.59635 9.76644 9.91504C10.0636 10.2301 10.4396 10.3877 10.8944 10.3877C11.4279 10.3877 11.8451 10.1836 12.1458 9.77539C12.4502 9.36719 12.6024 8.79964 12.6024 8.07275C12.6024 7.46045 12.4609 6.98063 12.1781 6.6333C11.8952 6.28597 11.512 6.1123 11.0286 6.1123C10.5166 6.1123 10.1048 6.29134 9.7933 6.64941C9.48177 7.00391 9.32601 7.44971 9.32601 7.98682Z"/></svg>'}),b=new u.LabIcon({name:"search-replace:expandAll",svgstr:'<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path d="M9 9H4v1h5V9z"/><path d="M7 12V7H6v5h1z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"/></svg>'}),k=new u.LabIcon({name:"search-replace:collapseAll",svgstr:'<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path d="M9 9H4v1h5V9z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"/></svg>'}),F=new u.LabIcon({name:"search-replace:replaceAll",svgstr:'<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.6 2.677c.147-.31.356-.465.626-.465.248 0 .44.118.573.353.134.236.201.557.201.966 0 .443-.078.798-.235 1.067-.156.268-.365.402-.627.402-.237 0-.416-.125-.537-.374h-.008v.31H11V1h.593v1.677h.008zm-.016 1.1a.78.78 0 0 0 .107.426c.071.113.163.169.274.169.136 0 .24-.072.314-.216.075-.145.113-.35.113-.615 0-.22-.035-.39-.104-.514-.067-.124-.164-.187-.29-.187-.12 0-.219.062-.297.185a.886.886 0 0 0-.117.48v.272zM4.12 7.695L2 5.568l.662-.662 1.006 1v-1.51A1.39 1.39 0 0 1 5.055 3H7.4v.905H5.055a.49.49 0 0 0-.468.493l.007 1.5.949-.944.656.656-2.08 2.085zM9.356 4.93H10V3.22C10 2.408 9.685 2 9.056 2c-.135 0-.285.024-.45.073a1.444 1.444 0 0 0-.388.167v.665c.237-.203.487-.304.75-.304.261 0 .392.156.392.469l-.6.103c-.506.086-.76.406-.76.961 0 .263.061.473.183.631A.61.61 0 0 0 8.69 5c.29 0 .509-.16.657-.48h.009v.41zm.004-1.355v.193a.75.75 0 0 1-.12.436.368.368 0 0 1-.313.17.276.276 0 0 1-.22-.095.38.38 0 0 1-.08-.248c0-.222.11-.351.332-.389l.4-.067zM7 12.93h-.644v-.41h-.009c-.148.32-.367.48-.657.48a.61.61 0 0 1-.507-.235c-.122-.158-.183-.368-.183-.63 0-.556.254-.876.76-.962l.6-.103c0-.313-.13-.47-.392-.47-.263 0-.513.102-.75.305v-.665c.095-.063.224-.119.388-.167.165-.049.315-.073.45-.073.63 0 .944.407.944 1.22v1.71zm-.64-1.162v-.193l-.4.068c-.222.037-.333.166-.333.388 0 .1.027.183.08.248a.276.276 0 0 0 .22.095.368.368 0 0 0 .312-.17c.08-.116.12-.26.12-.436zM9.262 13c.321 0 .568-.058.738-.173v-.71a.9.9 0 0 1-.552.207.619.619 0 0 1-.5-.215c-.12-.145-.181-.345-.181-.598 0-.26.063-.464.189-.612a.644.644 0 0 1 .516-.223c.194 0 .37.069.528.207v-.749c-.129-.09-.338-.134-.626-.134-.417 0-.751.14-1.001.422-.249.28-.373.662-.373 1.148 0 .42.116.764.349 1.03.232.267.537.4.913.4zM2 9l1-1h9l1 1v5l-1 1H3l-1-1V9zm1 0v5h9V9H3zm3-2l1-1h7l1 1v5l-1 1V7H6z"/></svg>'}),j=new u.LabIcon({name:"search-replace:replace",svgstr:'<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.221 3.739l2.261 2.269L7.7 3.784l-.7-.7-1.012 1.007-.008-1.6a.523.523 0 0 1 .5-.526H8V1H6.48A1.482 1.482 0 0 0 5 2.489V4.1L3.927 3.033l-.706.706zm6.67 1.794h.01c.183.311.451.467.806.467.393 0 .706-.168.94-.503.236-.335.353-.78.353-1.333 0-.511-.1-.913-.301-1.207-.201-.295-.488-.442-.86-.442-.405 0-.718.194-.938.581h-.01V1H9v4.919h.89v-.386zm-.015-1.061v-.34c0-.248.058-.448.175-.601a.54.54 0 0 1 .445-.23.49.49 0 0 1 .436.233c.104.154.155.368.155.643 0 .33-.056.587-.169.768a.524.524 0 0 1-.47.27.495.495 0 0 1-.411-.211.853.853 0 0 1-.16-.532zM9 12.769c-.256.154-.625.231-1.108.231-.563 0-1.02-.178-1.369-.533-.349-.355-.523-.813-.523-1.374 0-.648.186-1.158.56-1.53.374-.376.875-.563 1.5-.563.433 0 .746.06.94.179v.998a1.26 1.26 0 0 0-.792-.276c-.325 0-.583.1-.774.298-.19.196-.283.468-.283.816 0 .338.09.603.272.797.182.191.431.287.749.287.282 0 .558-.092.828-.276v.946zM4 7L3 8v6l1 1h7l1-1V8l-1-1H4zm0 1h7v6H4V8z"/></svg>'});function M(e){const{matches:t,path:a,expandStatus:r,maxMatchesPerFiles:l,setExpandStatus:s,onMatchClick:n,onReplace:i,trans:c}=e;if(0===t.length)return null;t.sort(((e,t)=>e.path>t.path?1:-1));const o=t.map(((e,t)=>{const o=e.matches.length>=l;return E().createElement(x.TreeItem,{className:"search-tree-files",expanded:r[t],onClick:()=>{const e=[...r];e[t]=!e[t],s(e)}},E().createElement("span",{title:e.path},e.path),i&&E().createElement(x.Button,{className:"jp-search-replace-item-button jp-mod-icon-only",appearance:"neutral",title:c.__("Replace All in File"),onClick:t=>{t.stopPropagation();const r=[{path:e.path,matches:e.matches}];i(r,m.PathExt.join(a,e.path))}},E().createElement(F.react,null)),o?E().createElement(x.Badge,{slot:"end",fill:"warning",color:"warning",title:c.__("Maximal number of matches is reached for this file. You can increase it in the settings.")},e.matches.length,o&&"+"):E().createElement(x.Badge,{slot:"end"},e.matches.length),e.matches.map((t=>{const r=i&&null!==t.replace;return E().createElement(x.TreeItem,{className:"search-tree-matches",onClick:r=>{r.stopPropagation(),n(m.PathExt.join(a,e.path),t)}},E().createElement("span",{title:t.line.trim()},t.line.slice(0,t.start_utf8),r?E().createElement(E().Fragment,null,E().createElement("del",null,t.match),E().createElement("ins",null,t.replace)):E().createElement("mark",null,t.match),t.line.slice(t.end_utf8)),r&&E().createElement(x.Button,{className:"jp-search-replace-item-button jp-mod-icon-only",appearance:"neutral",title:c.__("Replace"),onClick:r=>{r.stopPropagation();const l=[{path:e.path,matches:[t]}];i(l,m.PathExt.join(a,e.path))}},E().createElement(j.react,null)))})))}));return E().createElement("div",{className:"jp-search-replace-list"},E().createElement(x.TreeView,null,o))}class I extends s.VDomRenderer{constructor(e,t,a,r,l,s){super(e),this.commands=t,this.docManager=a,this.sanitizer=r,this.trans=l,this.onAskReplaceChanged=s,this._askReplaceConfirmation=!0,this.searchInputRef=E().createRef(),this.addClass("jp-search-replace-tab"),this.addClass("jp-search-replace-column")}get askReplaceConfirmation(){return this._askReplaceConfirmation}set askReplaceConfirmation(e){this._askReplaceConfirmation!==e&&(this._askReplaceConfirmation=e,this.onAskReplaceChanged(e))}onAfterShow(e){var t;super.onAfterShow(e),null===(t=this.searchInputRef.current)||void 0===t||t.focus()}render(){const e=this.model.queryResults.map((e=>e.path)),t=e.length,a=this.model.queryResults.reduce(((e,t)=>e+t.matches.length),0);let r=!1;if(this.docManager)for(const t of e){const e=this.docManager.findWidget(m.PathExt.join(this.model.path,t));if(e){const t=this.docManager.contextForWidget(e);if(null==t?void 0:t.model.dirty){r=!0;break}}}return E().createElement(N,{searchInputRef:this.searchInputRef,searchString:this.model.searchQuery,onSearchChanged:e=>{this.model.searchQuery=e},replaceString:this.model.replaceString,onReplaceString:e=>{this.model.replaceString=e},onReplace:async(e,r)=>{if(r)await this.replaceInFile(r,e[0].matches),this.model.refresh();else{if(this.askReplaceConfirmation){const e=await(0,s.showDialog)({title:this.trans.__("Replace All"),body:new S(this.trans._n("Replace %2 matche(s) accross %1 file with %3? This cannot be undone.","Replace %2 matches accross %1 files with %3? This cannot be undone.",t,a,this.model.replaceString),this.trans.__("Skip confirmation next time.")),buttons:[s.Dialog.cancelButton({label:this.trans.__("Cancel")}),s.Dialog.okButton({label:this.trans.__("Replace")})]});if(!e.button.accept)return;!0===e.value&&(this.askReplaceConfirmation=!1)}await this.model.replace(e)}},isLoading:this.model.isLoading,queryResults:this.model.error?[]:this.model.queryResults,onMatchClick:(e,t)=>{this.openFile(e,t)},refresh:()=>{this.model.refresh()},path:this.model.path,onPathChanged:e=>{this.model.path=e},maxLinesPerFile:this.model.maxLinesPerFile,options:E().createElement(E().Fragment,null,E().createElement(x.Button,{className:"jp-mod-icon-only",title:this.trans.__("Match Case"),appearance:this.model.caseSensitive?"accent":"neutral",onClick:()=>{this.model.caseSensitive=!this.model.caseSensitive}},E().createElement(u.caseSensitiveIcon.react,null)),E().createElement(x.Button,{className:"jp-mod-icon-only",title:this.trans.__("Match Whole Word"),appearance:this.model.wholeWord?"accent":"neutral",onClick:()=>{this.model.wholeWord=!this.model.wholeWord}},E().createElement(R.react,null)),E().createElement(x.Button,{className:"jp-mod-icon-only",title:this.trans.__("Use Regular Expression"),appearance:this.model.useRegex?"accent":"neutral",onClick:()=>{this.model.useRegex=!this.model.useRegex}},E().createElement(u.regexIcon.react,null))),trans:this.trans},E().createElement(V,{includeFilters:this.model.includeFilters,excludeFilters:this.model.excludeFilters,onIncludeFiltersChange:e=>{this.model.includeFilters=e},onExcludeFiltersChange:e=>{this.model.excludeFilters=e},trans:this.trans}),this.model.error?E().createElement("div",{className:"jp-search-replace-warning"},E().createElement("p",{dangerouslySetInnerHTML:{__html:"ripgrep command not found."===this.model.error?this.sanitizer.sanitize(this.trans.__('<a href="%1" target="_blank">ripgrep</a> command was not found. You can install it using e.g. the <a href="%2" target="_blank">conda package manager</a>.',"https://github.com/BurntSushi/ripgrep#installation","https://anaconda.org/conda-forge/ripgrep")):this.model.error}})):E().createElement(E().Fragment,null,r&&E().createElement("div",{className:"jp-search-replace-warning"},E().createElement("p",null,this.trans.__("You have unsaved changes. The result(s) may be inexact. Save your work and refresh."))),this.model.searchQuery&&E().createElement("p",{className:"jp-search-replace-statistics"},this.model.queryResults.length?this.trans._n("%2 result(s) in %1 file","%2 results in %1 files",t,a):this.trans.__("No results found."))))}async openFile(e,t){const a=await this.commands.execute("docmanager:open",{factory:"Editor",path:e});if(t){await a.context.ready;const e=a.content.editor;try{const a=e.getOffsetAt({line:t.line_number-1,column:0});e.editor.dispatch({selection:w.EditorSelection.create([w.EditorSelection.range(a+t.start_utf8,a+t.end_utf8)]),scrollIntoView:!0})}catch(a){e.doc.setSelection({line:t.line_number-1,ch:t.start_utf8},{line:t.line_number-1,ch:t.end_utf8})}}return a}async replaceInFile(e,t){const a=await this.openFile(e);await Promise.all([a.context.ready,a.content.ready]);const r=a.content.editor,l=new p.PromiseDelegate;return window.setTimeout((()=>{l.resolve()}),300),await l.promise,t.sort(((e,t)=>e.line_number<t.line_number?1:e.line_number===t.line_number?e.start<t.start?1:e.start===t.start?0:-1:-1)).forEach(((e,l)=>{const s=r.getOffsetAt({line:e.line_number-1,column:0});if(null!==e.replace&&(a.content.model.sharedModel.updateSource(s+e.start_utf8,s+e.end_utf8,e.replace),l===t.length-1))try{r.editor.dispatch({selection:w.EditorSelection.create([w.EditorSelection.range(s+e.start_utf8,s+e.start_utf8+e.replace.length)]),scrollIntoView:!0})}catch(t){r.doc.setSelection({line:e.line_number-1,ch:e.start_utf8},{line:e.line_number-1,ch:e.start_utf8+e.replace.length})}})),await this.commands.execute("docmanager:save"),a}}const L=E().memo((e=>{const t=e.path.split("/");return E().createElement(x.Breadcrumb,{className:"jp-search-replace-breadcrumb"},E().createElement(x.BreadcrumbItem,{key:"root",className:"jp-search-replace-breacrumbitem",title:"/"},E().createElement(x.Button,{className:"jp-mod-icon-only",appearance:"stealth",onClick:()=>{e.onPathChanged("")}},E().createElement(u.folderIcon.react,null))),e.path&&t.map(((a,r)=>{const l=t.slice(0,r+1).join("/");return E().createElement(x.BreadcrumbItem,{key:a,className:"jp-search-replace-breacrumbitem",style:{flexGrow:r+1,flexShrink:t.length-r-1},title:"/"+l},E().createElement(x.Button,{className:"jp-search-replace-pathbutton",appearance:"lightweight",onClick:()=>{e.onPathChanged(l)}},a))})))})),N=e=>{const[t,a]=(0,C.useState)(!1),[r,l]=(0,C.useState)(new Array(e.queryResults.length).fill(!0));(0,C.useEffect)((()=>{l(new Array(e.queryResults.length).fill(!0))}),[e.queryResults]);const s=r.some((e=>e)),n=t&&""!==e.replaceString&&e.queryResults.length>0;return E().createElement(E().Fragment,null,E().createElement("div",{className:"jp-stack-panel-header jp-search-replace-column"},E().createElement("div",{className:"jp-search-replace-header jp-search-replace-row"},E().createElement("h2",null,e.trans.__("Search")),E().createElement("div",{className:"jp-Toolbar-spacer"}),E().createElement(x.Toolbar,null,E().createElement(x.Button,{className:"jp-mod-icon-only",appearance:"stealth",title:e.trans.__("Refresh"),onClick:()=>{e.refresh()}},E().createElement(u.refreshIcon.react,null)),E().createElement(x.Button,{className:"jp-mod-icon-only",appearance:"stealth",title:s?e.trans.__("Collapse All"):e.trans.__("Expand All"),disabled:0===e.queryResults.length,onClick:()=>{const t=new Array(e.queryResults.length).fill(!s);l(t)}},s?E().createElement(k.react,null):E().createElement(b.react,null)))),E().createElement(L,{path:e.path,onPathChanged:e.onPathChanged})),E().createElement("div",{className:"jp-search-replace-row jp-search-replace-collapser"},E().createElement(x.Button,{className:"jp-mod-icon-only",appearance:"stealth",title:e.trans.__("Toggle Replace"),onClick:()=>{a(!t)}},t?E().createElement(u.caretDownIcon.react,null):E().createElement(u.caretRightIcon.react,null)),E().createElement("div",{className:"jp-search-replace-column"},E().createElement("div",{className:"jp-search-replace-row"},E().createElement(x.TextField,{ref:e.searchInputRef,appearance:"outline",type:"text",placeholder:e.trans.__("Search"),"aria-label":e.trans.__("Search Files for Text"),onChange:t=>{e.onSearchChanged(t.target.value)},onInput:t=>{e.onSearchChanged(t.target.value)},value:e.searchString}),E().createElement(x.Toolbar,null,e.options)),t&&E().createElement("div",{className:"jp-search-replace-row"},E().createElement(x.TextField,{appearance:"outline",placeholder:e.trans.__("Replace"),onInput:t=>{e.onReplaceString(t.target.value)},value:e.replaceString}),E().createElement(x.Button,{className:"jp-mod-icon-only",appearance:"stealth",title:e.trans.__("Replace All"),disabled:!n,onClick:()=>{e.onReplace(e.queryResults)}},E().createElement(F.react,null))))),e.children,e.isLoading?E().createElement(x.Progress,null):e.searchString&&E().createElement(M,{matches:e.queryResults,path:e.path,expandStatus:r,maxMatchesPerFiles:e.maxLinesPerFile,onMatchClick:e.onMatchClick,setExpandStatus:l,onReplace:n?e.onReplace:null,trans:e.trans}))},V=E().memo((e=>{const[t,a]=(0,C.useState)(!1),{includeFilters:r,onIncludeFiltersChange:l,excludeFilters:s,onExcludeFiltersChange:n,trans:i}=e;return E().createElement("div",{className:"jp-search-replace-filtersBox jp-search-replace-column"},E().createElement(x.Button,{className:"jp-search-replace-filters-collapser jp-mod-icon-only",appearance:"stealth",title:e.trans.__("Toggle Search Filters"),onClick:()=>{a(!t)}},E().createElement(u.ellipsesIcon.react,null)),t&&E().createElement(E().Fragment,null,E().createElement("label",{className:"jp-search-replace-column"},i.__("Include file filters"),E().createElement(x.TextField,{appearance:"outline",placeholder:i.__("e.g. *.py, src/**/include"),onChange:e=>{l(e.target.value)},onInput:e=>{l(e.target.value)},value:r})),E().createElement("label",{className:"jp-search-replace-column"},i.__("Exclude file filters"),E().createElement(x.TextField,{appearance:"outline",placeholder:i.__("e.g. *.py, src/**/exclude"),onChange:e=>{n(e.target.value)},onInput:e=>{n(e.target.value)},value:s}))))})),H={id:"jupyterlab-search-replace:plugin",autoStart:!0,requires:[s.ISanitizer,i.IFileBrowserFactory,c.IEditorTracker],optional:[n.IDocumentManager,i.IDefaultFileBrowser,o.ISettingRegistry,h.ITranslator,l.INotebookTree],activate:(e,t,a,l,s,n,i,c,o)=>{const p=(null!=c?c:h.nullTranslator).load("search_replace");(0,r.addJupyterLabThemeChangeListener)();const d=new v;let m=null;const g=new I(d,e.commands,s,t,p,(async e=>{m&&await m.set("askReplaceAllConfirmation",e)}));i&&i.load(H.id).then((e=>{m=e;const t=e=>{d.defaultExcludeFilters=e.get("exclude").composite,d.maxLinesPerFile=e.get("maxLinesPerFile").composite,g.askReplaceConfirmation=e.get("askReplaceAllConfirmation").composite};t(e),e.changed.connect(t)})).catch((e=>{console.error(`Failed to load settings ${H.id}.`,e)}));const _=null!=n?n:a.defaultBrowser;Promise.all([e.restored,_.model.restored]).then((()=>{d.path=_.model.path})),_.model.pathChanged.connect(((e,t)=>{d.path=t.newValue})),g.title.caption=p.__("Search and Replace"),g.id="jp-search-replace",g.title.icon=u.searchIcon,o?(g.title.label=p.__("Search"),o.addWidget(g)):e.shell.add(g,"left")}},P=H}}]);