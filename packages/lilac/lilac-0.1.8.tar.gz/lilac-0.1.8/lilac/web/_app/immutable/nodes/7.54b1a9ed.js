import{S as ge,i as ve,s as be,E as Ee,Z as ke,_ as Se,m as w,h as f,n as _,$ as Fe,b as x,a0 as c,L as nt,a1 as ee,N as ze,Q as Me,q as J,r as X,u as re,P as rt,am as it,ai as ot,k as S,a as A,y as G,l as I,c as F,z as H,A as U,H as he,g as P,d as z,B as L,O as $e,C as Ze,al as ce,an as _e,v as Te,f as ye,M as ut,a4 as ct,p as fe,ab as xe,w as Oe,T as Ke,G as Be,U as Ge}from"../chunks/index.bbac10d2.js";import{D as ft}from"../chunks/DatasetFieldEmbeddingSelector.e0eff7a2.js";import{P as dt}from"../chunks/Page.b49c4ddf.js";import{w as mt}from"../chunks/index.bc58569c.js";import{bh as pt,bi as ht,A as _t,M as gt,G as vt,H as bt,ad as He,b2 as wt,aU as Et,au as de,al as me,c as et,a9 as kt,g as St,aX as It,J as Vt,a_ as Nt,a$ as $t,bq as Tt}from"../chunks/Commands.5e9f8118.js";import{T as yt,c as pe}from"../chunks/colors.78d1fcdd.js";import{S as Rt}from"../chunks/Search.66803d1d.js";class Dt{static generateCompletion(t){return pt(ht,{method:"GET",url:"/api/v1/rag/generate_completion",query:{prompt:t},errors:{422:"Validation Error"}})}}function Ue(l){let t,s;return{c(){t=ke("title"),s=J(l[1])},l(e){t=Se(e,"title",{});var a=w(t);s=X(a,l[1]),a.forEach(f)},m(e,a){x(e,t,a),c(t,s)},p(e,a){a&2&&re(s,e[1])},d(e){e&&f(t)}}}function Ct(l){let t,s,e=l[1]&&Ue(l),a=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:l[0]},{height:l[0]},l[2],l[3]],r={};for(let i=0;i<a.length;i+=1)r=Ee(r,a[i]);return{c(){t=ke("svg"),e&&e.c(),s=ke("path"),this.h()},l(i){t=Se(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var n=w(t);e&&e.l(n),s=Se(n,"path",{d:!0}),w(s).forEach(f),n.forEach(f),this.h()},h(){_(s,"d","M2 26H30V28H2zM25.4 9c.8-.8.8-2 0-2.8 0 0 0 0 0 0l-3.6-3.6c-.8-.8-2-.8-2.8 0 0 0 0 0 0 0l-15 15V24h6.4L25.4 9zM20.4 4L24 7.6l-3 3L17.4 7 20.4 4zM6 22v-3.6l10-10 3.6 3.6-10 10H6z"),Fe(t,r)},m(i,n){x(i,t,n),e&&e.m(t,null),c(t,s)},p(i,[n]){i[1]?e?e.p(i,n):(e=Ue(i),e.c(),e.m(t,s)):e&&(e.d(1),e=null),Fe(t,r=nt(a,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},n&1&&{width:i[0]},n&1&&{height:i[0]},n&4&&i[2],n&8&&i[3]]))},i:ee,o:ee,d(i){i&&f(t),e&&e.d()}}}function qt(l,t,s){let e,a;const r=["size","title"];let i=ze(t,r),{size:n=16}=t,{title:u=void 0}=t;return l.$$set=m=>{s(5,t=Ee(Ee({},t),Me(m))),s(3,i=ze(t,r)),"size"in m&&s(0,n=m.size),"title"in m&&s(1,u=m.title)},l.$$.update=()=>{s(4,e=t["aria-label"]||t["aria-labelledby"]||u),s(2,a={"aria-hidden":e?void 0:!0,role:e?"img":void 0,focusable:Number(t.tabindex)===0?!0:void 0})},t=Me(t),[n,u,a,i,e]}class Pt extends ge{constructor(t){super(),ve(this,t,qt,Ct,be,{size:0,title:1})}}const Ie="RAG_VIEW_CONTEXT",tt="{query_str}",Ve="{context_str}";function Ne(){return{datasetNamespace:null,datasetName:null,path:null,embedding:null,query:null,promptTemplate:`Context information is below.
---------------------
${Ve}
---------------------
Given the context information and not prior knowledge, answer the query.
Query: ${tt}
Answer: `,topK:10,windowSizeChunks:1}}function At(){const l=Ne(),{subscribe:t,set:s,update:e}=mt(JSON.parse(JSON.stringify(l)));return{subscribe:t,set:s,update:e,reset:()=>{s(JSON.parse(JSON.stringify(l)))},setDatasetPathEmbedding:(r,i,n)=>{e(u=>(r==null?(u.datasetNamespace=null,u.datasetName=null):(u.datasetNamespace=r.namespace,u.datasetName=r.name),u.path=i,u.embedding=n,u))},setQuestion:r=>{e(i=>(i.query=r,i))}}}function Ft(l){rt(Ie,l)}function st(){if(!it(Ie))throw new Error("RagViewContext not found");return ot(Ie)}function zt(l){let t,s;return t=new yt({props:{value:l[2]||void 0,placeholder:"Enter a prompt template...",rows:12,class:"mb-2 w-full"}}),t.$on("input",l[4]),{c(){G(t.$$.fragment)},l(e){H(t.$$.fragment,e)},m(e,a){U(t,e,a),s=!0},p(e,a){const r={};a&4&&(r.value=e[2]||void 0),t.$set(r)},i(e){s||(P(t.$$.fragment,e),s=!0)},o(e){z(t.$$.fragment,e),s=!1},d(e){L(t,e)}}}function Mt(l){let t,s,e,a,r,i;return t=new gt({props:{title:"Edit prompt template"}}),e=new vt({props:{hasForm:!0,$$slots:{default:[zt]},$$scope:{ctx:l}}}),r=new bt({props:{primaryButtonText:"Save",secondaryButtonText:"Close",primaryButtonDisabled:!1}}),r.$on("click:button--secondary",l[11]),{c(){G(t.$$.fragment),s=A(),G(e.$$.fragment),a=A(),G(r.$$.fragment)},l(n){H(t.$$.fragment,n),s=F(n),H(e.$$.fragment,n),a=F(n),H(r.$$.fragment,n)},m(n,u){U(t,n,u),x(n,s,u),U(e,n,u),x(n,a,u),U(r,n,u),i=!0},p(n,u){const m={};u&32772&&(m.$$scope={dirty:u,ctx:n}),e.$set(m)},i(n){i||(P(t.$$.fragment,n),P(e.$$.fragment,n),P(r.$$.fragment,n),i=!0)},o(n){z(t.$$.fragment,n),z(e.$$.fragment,n),z(r.$$.fragment,n),i=!1},d(n){L(t,n),n&&f(s),L(e,n),n&&f(a),L(r,n)}}}function xt(l){let t,s,e,a,r,i,n,u,m,p,g,y,E,v,h,T;return u=new Pt({}),E=new _t({props:{open:l[1],$$slots:{default:[Mt]},$$scope:{ctx:l}}}),E.$on("submit",l[5]),E.$on("close",l[12]),{c(){t=S("div"),s=S("div"),e=S("div"),a=J("Prompt"),r=A(),i=S("div"),n=S("button"),G(u.$$.fragment),m=A(),p=S("div"),g=J(l[0]),y=A(),G(E.$$.fragment),this.h()},l(V){t=I(V,"DIV",{class:!0});var o=w(t);s=I(o,"DIV",{class:!0});var b=w(s);e=I(b,"DIV",{});var R=w(e);a=X(R,"Prompt"),R.forEach(f),r=F(b),i=I(b,"DIV",{class:!0});var k=w(i);n=I(k,"BUTTON",{});var C=w(n);H(u.$$.fragment,C),C.forEach(f),k.forEach(f),b.forEach(f),m=F(o),p=I(o,"DIV",{class:!0});var d=w(p);g=X(d,l[0]),d.forEach(f),o.forEach(f),y=F(V),H(E.$$.fragment,V),this.h()},h(){_(i,"class","h-4"),_(s,"class","rag-section-header mb-4 flex w-full flex-row justify-between"),_(p,"class","h-96 overflow-y-scroll whitespace-break-spaces leading-6"),_(t,"class","flex h-full w-full flex-col overflow-y-scroll")},m(V,o){x(V,t,o),c(t,s),c(s,e),c(e,a),c(s,r),c(s,i),c(i,n),U(u,n,null),c(t,m),c(t,p),c(p,g),x(V,y,o),U(E,V,o),v=!0,h||(T=he(n,"click",l[10]),h=!0)},p(V,[o]){(!v||o&1)&&re(g,V[0]);const b={};o&2&&(b.open=V[1]),o&32774&&(b.$$scope={dirty:o,ctx:V}),E.$set(b)},i(V){v||(P(u.$$.fragment,V),P(E.$$.fragment,V),v=!0)},o(V){z(u.$$.fragment,V),z(E.$$.fragment,V),v=!1},d(V){V&&f(t),L(u),V&&f(y),L(E,V),h=!1,T()}}}function Ot(l,t,s){let e,a,r,{questionInputText:i}=t,{retrievalResults:n}=t;const u=st();$e(l,u,o=>s(9,r=o));const m=Ze();let p=!1,g="";function y(o,b){return g.replace(tt,o).replace(Ve,b)}function E(o){s(2,g=o.target.value)}function v(){s(1,p=!1)}const h=()=>s(1,p=!0),T=()=>{close(),s(1,p=!1)},V=()=>s(1,p=!1);return l.$$set=o=>{"questionInputText"in o&&s(6,i=o.questionInputText),"retrievalResults"in o&&s(7,n=o.retrievalResults)},l.$$.update=()=>{l.$$.dirty&512&&r.promptTemplate!=null&&s(2,g=r.promptTemplate),l.$$.dirty&128&&s(8,e=n==null?Ve:n.map(o=>o.contextText).join(`
`)),l.$$.dirty&320&&s(0,a=y(i,e)),l.$$.dirty&641&&n!=null&&r.query!=null&&m("prompt",a)},[a,p,g,u,E,v,i,n,e,r,h,T,V]}class Kt extends ge{constructor(t){super(),ve(this,t,Ot,xt,be,{questionInputText:6,retrievalResults:7})}}function Le(l,t,s){var i,n,u,m;const e=l.slice();e[14]=t[s];const a=e[14].text.slice((i=e[14].windowSpan)==null?void 0:i.start,(n=e[14].span)==null?void 0:n.start);e[15]=a;const r=e[14].text.slice((u=e[14].span)==null?void 0:u.end,(m=e[14].windowSpan)==null?void 0:m.end);return e[16]=r,e}function Qe(l){let t,s;return t=new et({props:{lines:l[1].topK}}),{c(){G(t.$$.fragment)},l(e){H(t.$$.fragment,e)},m(e,a){U(t,e,a),s=!0},p(e,a){const r={};a&2&&(r.lines=e[1].topK),t.$set(r)},i(e){s||(P(t.$$.fragment,e),s=!0)},o(e){z(t.$$.fragment,e),s=!1},d(e){L(t,e)}}}function Je(l){let t,s=l[0],e=[];for(let a=0;a<s.length;a+=1)e[a]=Ye(Le(l,s,a));return{c(){t=S("div");for(let a=0;a<e.length;a+=1)e[a].c();this.h()},l(a){t=I(a,"DIV",{class:!0});var r=w(t);for(let i=0;i<e.length;i+=1)e[i].l(r);r.forEach(f),this.h()},h(){_(t,"class","flex h-96 flex-col overflow-y-scroll")},m(a,r){x(a,t,r);for(let i=0;i<e.length;i+=1)e[i]&&e[i].m(t,null)},p(a,r){if(r&1){s=a[0];let i;for(i=0;i<s.length;i+=1){const n=Le(a,s,i);e[i]?e[i].p(n,r):(e[i]=Ye(n),e[i].c(),e[i].m(t,null))}for(;i<e.length;i+=1)e[i].d(1);e.length=s.length}},d(a){a&&f(t),ct(e,a)}}}function Xe(l){let t,s=l[15]+"",e;return{c(){t=S("span"),e=J(s),this.h()},l(a){t=I(a,"SPAN",{class:!0});var r=w(t);e=X(r,s),r.forEach(f),this.h()},h(){_(t,"class","whitespace-break-spaces")},m(a,r){x(a,t,r),c(t,e)},p(a,r){r&1&&s!==(s=a[15]+"")&&re(e,s)},d(a){a&&f(t)}}}function je(l){let t,s=l[16]+"",e;return{c(){t=S("span"),e=J(s),this.h()},l(a){t=I(a,"SPAN",{class:!0});var r=w(t);e=X(r,s),r.forEach(f),this.h()},h(){_(t,"class","whitespace-break-spaces")},m(a,r){x(a,t,r),c(t,e)},p(a,r){r&1&&s!==(s=a[16]+"")&&re(e,s)},d(a){a&&f(t)}}}function Ye(l){var T,V;let t,s,e,a=l[14].score.toFixed(2)+"",r,i,n,u,m,p=l[14].text.slice((T=l[14].span)==null?void 0:T.start,(V=l[14].span)==null?void 0:V.end)+"",g,y,E,v=l[15]!=""&&Xe(l),h=l[16]!=""&&je(l);return{c(){t=S("div"),s=S("div"),e=S("span"),r=J(a),i=A(),n=S("div"),v&&v.c(),u=A(),m=S("span"),g=J(p),y=A(),h&&h.c(),E=A(),this.h()},l(o){t=I(o,"DIV",{class:!0});var b=w(t);s=I(b,"DIV",{class:!0});var R=w(s);e=I(R,"SPAN",{class:!0});var k=w(e);r=X(k,a),k.forEach(f),R.forEach(f),i=F(b),n=I(b,"DIV",{class:!0});var C=w(n);v&&v.l(C),u=F(C),m=I(C,"SPAN",{class:!0});var d=w(m);g=X(d,p),d.forEach(f),y=F(C),h&&h.l(C),C.forEach(f),E=F(b),b.forEach(f),this.h()},h(){_(e,"class","px-0.5"),fe(e,"background-color",pe(l[14].score)),_(s,"class","w-16"),_(m,"class","whitespace-break-spaces"),fe(m,"background-color",pe(l[14].score)),_(n,"class","grow"),_(t,"class","flex flex-row gap-x-2 border-b border-b-neutral-200 py-2 text-sm")},m(o,b){x(o,t,b),c(t,s),c(s,e),c(e,r),c(t,i),c(t,n),v&&v.m(n,null),c(n,u),c(n,m),c(m,g),c(n,y),h&&h.m(n,null),c(t,E)},p(o,b){var R,k;b&1&&a!==(a=o[14].score.toFixed(2)+"")&&re(r,a),b&1&&fe(e,"background-color",pe(o[14].score)),o[15]!=""?v?v.p(o,b):(v=Xe(o),v.c(),v.m(n,u)):v&&(v.d(1),v=null),b&1&&p!==(p=o[14].text.slice((R=o[14].span)==null?void 0:R.start,(k=o[14].span)==null?void 0:k.end)+"")&&re(g,p),b&1&&fe(m,"background-color",pe(o[14].score)),o[16]!=""?h?h.p(o,b):(h=je(o),h.c(),h.m(n,null)):h&&(h.d(1),h=null)},d(o){o&&f(t),v&&v.d(),h&&h.d()}}}function Bt(l){var M;let t,s,e,a,r,i,n,u,m,p,g,y,E,v,h,T,V,o,b,R,k,C,d=((M=l[2])==null?void 0:M.isFetching)&&Qe(l),D=l[0]!=null&&Je(l);return{c(){t=S("div"),s=S("div"),e=J("Retrieval"),a=A(),r=S("div"),i=S("div"),n=S("span"),u=J("Chunk window"),m=A(),p=S("input"),g=A(),y=S("div"),E=S("span"),v=J("Top K"),h=A(),T=S("input"),V=A(),o=S("div"),d&&d.c(),b=A(),D&&D.c(),this.h()},l(N){t=I(N,"DIV",{class:!0});var q=w(t);s=I(q,"DIV",{});var j=w(s);e=X(j,"Retrieval"),j.forEach(f),a=F(q),r=I(q,"DIV",{class:!0});var B=w(r);i=I(B,"DIV",{});var O=w(i);n=I(O,"SPAN",{class:!0});var Q=w(n);u=X(Q,"Chunk window"),Q.forEach(f),m=F(O),p=I(O,"INPUT",{type:!0,class:!0,min:!0,max:!0}),O.forEach(f),g=F(B),y=I(B,"DIV",{});var Y=w(y);E=I(Y,"SPAN",{class:!0});var le=w(E);v=X(le,"Top K"),le.forEach(f),h=F(Y),T=I(Y,"INPUT",{type:!0,class:!0}),Y.forEach(f),B.forEach(f),q.forEach(f),V=F(N),o=I(N,"DIV",{class:!0});var W=w(o);d&&d.l(W),b=F(W),D&&D.l(W),W.forEach(f),this.h()},h(){_(n,"class","mr-2"),_(p,"type","number"),_(p,"class","w-16 px-2"),_(p,"min","0"),_(p,"max","10"),_(E,"class","mr-2"),_(T,"type","number"),_(T,"class","w-16 px-2"),_(r,"class","flex h-4 flex-row gap-x-4 font-normal"),_(t,"class","rag-section-header mb-4 flex w-full flex-row justify-between"),_(o,"class","mb-8 h-full")},m(N,q){x(N,t,q),c(t,s),c(s,e),c(t,a),c(t,r),c(r,i),c(i,n),c(n,u),c(i,m),c(i,p),ce(p,l[1].windowSizeChunks),c(r,g),c(r,y),c(y,E),c(E,v),c(y,h),c(y,T),ce(T,l[1].topK),x(N,V,q),x(N,o,q),d&&d.m(o,null),c(o,b),D&&D.m(o,null),R=!0,k||(C=[he(p,"input",l[11]),he(T,"input",l[12])],k=!0)},p(N,[q]){var j;q&2&&_e(p.value)!==N[1].windowSizeChunks&&ce(p,N[1].windowSizeChunks),q&2&&_e(T.value)!==N[1].topK&&ce(T,N[1].topK),(j=N[2])!=null&&j.isFetching?d?(d.p(N,q),q&4&&P(d,1)):(d=Qe(N),d.c(),P(d,1),d.m(o,b)):d&&(Te(),z(d,1,1,()=>{d=null}),ye()),N[0]!=null?D?D.p(N,q):(D=Je(N),D.c(),D.m(o,null)):D&&(D.d(1),D=null)},i(N){R||(P(d),R=!0)},o(N){z(d),R=!1},d(N){N&&f(t),N&&f(V),N&&f(o),d&&d.d(),D&&D.d(),k=!1,ut(C)}}}function Gt(l,t,s){let e,a,r,i,n,u,m=ee,p=()=>(m(),m=xe(r,k=>s(2,u=k)),r),g,y=ee,E=()=>(y(),y=xe(a,k=>s(10,g=k)),a);l.$$.on_destroy.push(()=>m()),l.$$.on_destroy.push(()=>y());let{retrievalResults:v=void 0}=t;const h=st();$e(l,h,k=>s(1,n=k));let{isFetching:T=!1}=t;const V=Ze();let o=null;function b(){n.windowSizeChunks=_e(this.value),h.set(n)}function R(){n.topK=_e(this.value),h.set(n)}return l.$$set=k=>{"retrievalResults"in k&&s(0,v=k.retrievalResults),"isFetching"in k&&s(6,T=k.isFetching)},l.$$.update=()=>{var k;l.$$.dirty&2&&s(9,e={path:n.path,query:n.query,embedding:n.embedding,type:"semantic"}),l.$$.dirty&514&&n.path&&n.embedding&&n.query!=null&&s(7,o={columns:[He,n.path],limit:n.topK,combine_columns:!0,searches:[e]}),l.$$.dirty&130&&E(s(4,a=o&&n.datasetNamespace&&n.datasetName?wt(n.datasetNamespace,n.datasetName,{columns:o.columns,searches:o.searches,combine_columns:o.combine_columns}):null)),l.$$.dirty&1154&&p(s(3,r=o!=null&&n.datasetNamespace!=null&&n.datasetName!=null&&(g==null?void 0:g.data)!=null?Et(n.datasetNamespace,n.datasetName,o,g.data.schema):null)),l.$$.dirty&1028&&s(6,T=(u==null?void 0:u.isFetching)||(g==null?void 0:g.isFetching)||!1),l.$$.dirty&64&&T&&s(0,v=void 0),l.$$.dirty&1024&&s(8,i=(g==null?void 0:g.data)!=null?kt(g.data.schema).filter(C=>C.signal!=null&&C.signal.signal_name==="semantic_similarity")[0]:null),l.$$.dirty&262&&i!=null&&n.path!=null&&(u==null?void 0:u.data)!=null&&s(0,v=(((k=u.data)==null?void 0:k.rows)||[]).flatMap(C=>{const d=de(C,i.path);if(d==null)return[];const D=me.value(de(C,n.path)),M=[],N=[];for(const q of d){const j=me.span(q),B=me.value(de(q,["score"]),"float32");N.push({span:j,score:B,text:D})}for(const[q,{span:j,score:B,text:O}]of N.entries()){const Q=N[Math.max(0,q-n.windowSizeChunks)].span,Y=N[Math.min(N.length-1,q+n.windowSizeChunks)].span,le=O.slice(Q==null?void 0:Q.start,Y==null?void 0:Y.end);M.push({rowid:me.value(de(C,[He])),span:j,windowSpan:{start:Q.start,end:Y.end},text:O,contextText:le,score:B,spanIndex:q,rowChunkSpans:N.map(W=>W.span)})}return M}).sort((C,d)=>d.score-C.score).slice(0,n.topK)),l.$$.dirty&1&&V("results",v)},[v,n,u,r,a,h,T,o,i,e,g,b,R]}class Ht extends ge{constructor(t){super(),ve(this,t,Gt,Bt,be,{retrievalResults:0,isFetching:6})}}function Ut(l){let t,s;return{c(){t=S("div"),s=J("Press the search button to answer the question."),this.h()},l(e){t=I(e,"DIV",{class:!0});var a=w(t);s=X(a,"Press the search button to answer the question."),a.forEach(f),this.h()},h(){_(t,"class","whitespace-break-spaces font-light italic leading-5")},m(e,a){x(e,t,a),c(t,s)},p:ee,i:ee,o:ee,d(e){e&&f(t)}}}function Lt(l){let t,s,e;return s=new Tt({props:{source:l[10]}}),{c(){t=S("div"),G(s.$$.fragment),this.h()},l(a){t=I(a,"DIV",{class:!0});var r=w(t);H(s.$$.fragment,r),r.forEach(f),this.h()},h(){_(t,"class","markdown whitespace-break-spaces leading-5 svelte-10ktfub")},m(a,r){x(a,t,r),U(s,t,null),e=!0},p(a,r){const i={};r&1024&&(i.source=a[10]),s.$set(i)},i(a){e||(P(s.$$.fragment,a),e=!0)},o(a){z(s.$$.fragment,a),e=!1},d(a){a&&f(t),L(s)}}}function Qt(l){let t,s;return t=new et({}),{c(){G(t.$$.fragment)},l(e){H(t.$$.fragment,e)},m(e,a){U(t,e,a),s=!0},p:ee,i(e){s||(P(t.$$.fragment,e),s=!0)},o(e){z(t.$$.fragment,e),s=!1},d(e){L(t,e)}}}function Jt(l){let t,s,e,a,r,i,n,u,m,p,g,y,E,v,h,T,V,o,b,R,k,C,d,D,M,N,q,j,B,O,Q,Y,le;p=new Rt({props:{size:16}}),E=new Vt({props:{value:l[6],size:"xl",disabled:l[1].datasetName==null,placeholder:l[1].datasetName!=null?"Enter a question":"Choose a dataset"}}),E.$on("input",l[12]),E.$on("change",l[13]);const W=[Qt,Lt,Ut],te=[];function Re($,K){return $[9]||$[8]?0:$[10]!=null?1:2}R=Re(l),k=te[R]=W[R](l);function at($){l[16]($)}function lt($){l[17]($)}let we={};return l[7]!==void 0&&(we.retrievalResults=l[7]),l[8]!==void 0&&(we.isFetching=l[8]),M=new Ht({props:we}),Oe.push(()=>Ke(M,"retrievalResults",at)),Oe.push(()=>Ke(M,"isFetching",lt)),O=new Kt({props:{questionInputText:l[6],retrievalResults:l[7]}}),O.$on("prompt",l[18]),{c(){t=S("div"),s=S("div"),e=S("div"),a=S("div"),r=S("div"),i=J("Question"),n=A(),u=S("div"),m=S("button"),G(p.$$.fragment),y=A(),G(E.$$.fragment),v=A(),h=S("div"),T=S("div"),V=J("Answer"),o=A(),b=S("div"),k.c(),C=A(),d=S("div"),D=S("div"),G(M.$$.fragment),j=A(),B=S("div"),G(O.$$.fragment),this.h()},l($){t=I($,"DIV",{class:!0});var K=w(t);s=I(K,"DIV",{class:!0});var Z=w(s);e=I(Z,"DIV",{class:!0});var se=w(e);a=I(se,"DIV",{class:!0});var ae=w(a);r=I(ae,"DIV",{class:!0});var ne=w(r);i=X(ne,"Question"),ne.forEach(f),n=F(ae),u=I(ae,"DIV",{class:!0});var ie=w(u);m=I(ie,"BUTTON",{class:!0});var De=w(m);H(p.$$.fragment,De),De.forEach(f),y=F(ie),H(E.$$.fragment,ie),ie.forEach(f),ae.forEach(f),v=F(se),h=I(se,"DIV",{class:!0});var oe=w(h);T=I(oe,"DIV",{class:!0});var Ce=w(T);V=X(Ce,"Answer"),Ce.forEach(f),o=F(oe),b=I(oe,"DIV",{class:!0});var qe=w(b);k.l(qe),qe.forEach(f),oe.forEach(f),se.forEach(f),C=F(Z),d=I(Z,"DIV",{class:!0});var ue=w(d);D=I(ue,"DIV",{class:!0});var Pe=w(D);H(M.$$.fragment,Pe),Pe.forEach(f),j=F(ue),B=I(ue,"DIV",{class:!0});var Ae=w(B);H(O.$$.fragment,Ae),Ae.forEach(f),ue.forEach(f),Z.forEach(f),K.forEach(f),this.h()},h(){_(r,"class","font-medium"),_(m,"class","z-10 -mr-10 mb-2"),m.disabled=g=l[1].datasetName==null,Be(m,"opacity-10",l[1].datasetName==null),_(u,"class","question-input flex w-full flex-row items-end"),_(a,"class","flex flex-col gap-y-4"),_(T,"class","font-medium"),_(b,"class","pt-4"),_(h,"class","flex flex-col gap-y-4"),_(e,"class","mt-6 flex w-1/2 flex-col gap-y-10"),_(D,"class","w-1/2"),_(B,"class","w-1/2"),_(d,"class","flex grow flex-row gap-x-8"),_(s,"class","mx-4 mb-8 mt-2 flex h-full w-full flex-col items-start gap-y-24 px-4"),_(t,"class","h-full w-full overflow-x-hidden overflow-y-scroll")},m($,K){x($,t,K),c(t,s),c(s,e),c(e,a),c(a,r),c(r,i),c(a,n),c(a,u),c(u,m),U(p,m,null),c(u,y),U(E,u,null),c(e,v),c(e,h),c(h,T),c(T,V),c(h,o),c(h,b),te[R].m(b,null),c(s,C),c(s,d),c(d,D),U(M,D,null),c(d,j),c(d,B),U(O,B,null),Q=!0,Y||(le=he(m,"click",l[15]),Y=!0)},p($,K){(!Q||K&2&&g!==(g=$[1].datasetName==null))&&(m.disabled=g),(!Q||K&2)&&Be(m,"opacity-10",$[1].datasetName==null);const Z={};K&64&&(Z.value=$[6]),K&2&&(Z.disabled=$[1].datasetName==null),K&2&&(Z.placeholder=$[1].datasetName!=null?"Enter a question":"Choose a dataset"),E.$set(Z);let se=R;R=Re($),R===se?te[R].p($,K):(Te(),z(te[se],1,1,()=>{te[se]=null}),ye(),k=te[R],k?k.p($,K):(k=te[R]=W[R]($),k.c()),P(k,1),k.m(b,null));const ae={};!N&&K&128&&(N=!0,ae.retrievalResults=$[7],Ge(()=>N=!1)),!q&&K&256&&(q=!0,ae.isFetching=$[8],Ge(()=>q=!1)),M.$set(ae);const ne={};K&64&&(ne.questionInputText=$[6]),K&128&&(ne.retrievalResults=$[7]),O.$set(ne)},i($){Q||(P(p.$$.fragment,$),P(E.$$.fragment,$),P(k),P(M.$$.fragment,$),P(O.$$.fragment,$),Q=!0)},o($){z(p.$$.fragment,$),z(E.$$.fragment,$),z(k),z(M.$$.fragment,$),z(O.$$.fragment,$),Q=!1},d($){$&&f(t),L(p),L(E),te[R].d(),L(M),L(O),Y=!1,le()}}}function Xt(l){let t,s;return{c(){t=S("div"),s=J("Retrival Augmented Generation (RAG)"),this.h()},l(e){t=I(e,"DIV",{slot:!0,class:!0});var a=w(t);s=X(a,"Retrival Augmented Generation (RAG)"),a.forEach(f),this.h()},h(){_(t,"slot","header-subtext"),_(t,"class","text-lg")},m(e,a){x(e,t,a),c(t,s)},p:ee,d(e){e&&f(t)}}}function We(l){let t,s;return t=new ft({props:{inputSize:"sm",dataset:l[3],path:l[4],embedding:l[5]}}),t.$on("change",l[14]),{c(){G(t.$$.fragment)},l(e){H(t.$$.fragment,e)},m(e,a){U(t,e,a),s=!0},p(e,a){const r={};a&8&&(r.dataset=e[3]),a&16&&(r.path=e[4]),a&32&&(r.embedding=e[5]),t.$set(r)},i(e){s||(P(t.$$.fragment,e),s=!0)},o(e){z(t.$$.fragment,e),s=!1},d(e){L(t,e)}}}function jt(l){let t,s,e=l[2]&&We(l);return{c(){t=S("div"),e&&e.c(),this.h()},l(a){t=I(a,"DIV",{slot:!0,class:!0});var r=w(t);e&&e.l(r),r.forEach(f),this.h()},h(){_(t,"slot","header-right"),_(t,"class","dataset-selector py-2 svelte-10ktfub")},m(a,r){x(a,t,r),e&&e.m(t,null),s=!0},p(a,r){a[2]?e?(e.p(a,r),r&4&&P(e,1)):(e=We(a),e.c(),P(e,1),e.m(t,null)):e&&(Te(),z(e,1,1,()=>{e=null}),ye())},i(a){s||(P(e),s=!0)},o(a){z(e),s=!1},d(a){a&&f(t),e&&e.d()}}}function Yt(l){let t,s;return t=new dt({props:{hideTasks:!0,$$slots:{"header-right":[jt],"header-subtext":[Xt],default:[Jt]},$$scope:{ctx:l}}}),{c(){G(t.$$.fragment)},l(e){H(t.$$.fragment,e)},m(e,a){U(t,e,a),s=!0},p(e,[a]){const r={};a&1050623&&(r.$$scope={dirty:a,ctx:e}),t.$set(r)},i(e){s||(P(t.$$.fragment,e),s=!0)},o(e){z(t.$$.fragment,e),s=!1},d(e){L(t,e)}}}const Wt="";function Zt(l,t,s){let e;const a=At();$e(l,a,d=>s(1,e=d)),Ft(a);const r=St();let i=!1;It("rag",Wt,a,r,d=>$t(d,Ne()),d=>Nt(d,Ne()),()=>{s(2,i=!0)});let n,u,m,p="",g,y=!1,E,v=!1,h=null;function T(d){s(10,h=null),s(7,g=void 0),s(6,p=`${d.detail}`)}function V(){a.setQuestion(p)}const o=d=>{const{dataset:D,path:M,embedding:N}=d.detail;(D!=n||M!=u||N!=m)&&(s(3,n=D),s(4,u=M),s(5,m=N),a.setDatasetPathEmbedding(D,M,N))},b=()=>V();function R(d){g=d,s(7,g)}function k(d){y=d,s(8,y)}const C=d=>s(0,E=d.detail);return l.$$.update=()=>{l.$$.dirty&2&&(e.datasetNamespace!=null&&e.datasetName!=null&&s(3,n={namespace:e.datasetNamespace,name:e.datasetName}),e.path!=null&&s(4,u=e.path),e.embedding!=null&&s(5,m=e.embedding)),l.$$.dirty&2&&e.query!=null&&s(6,p=e.query),l.$$.dirty&1&&E!=null&&(s(9,v=!0),s(10,h=null),Dt.generateCompletion(E).then(d=>{s(10,h=d),s(9,v=!1)}))},[E,e,i,n,u,m,p,g,y,v,h,a,T,V,o,b,R,k,C]}class is extends ge{constructor(t){super(),ve(this,t,Zt,Yt,be,{})}}export{is as component};
