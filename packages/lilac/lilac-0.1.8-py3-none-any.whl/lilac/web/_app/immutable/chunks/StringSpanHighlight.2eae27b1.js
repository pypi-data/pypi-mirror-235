import{S as J,i as x,s as $,E as A,Z as O,_ as F,m as b,h as d,n as E,$ as X,b as y,a0 as p,L as me,a1 as z,N as Y,Q as W,q as M,r as I,u as j,k as C,y as le,l as H,z as ie,G as R,A as ne,a7 as de,V as ct,g as S,d as N,B as se,a as G,c as K,v as Q,f as Z,a2 as Ze,a3 as Ne,C as ut,H as he,M as Je,W as xe,X as ft,p as q,ag as dt,ao as ht,a4 as mt,O as Ce,ai as gt,e as He,a8 as Pe}from"./index.bbac10d2.js";import{aE as Ve,d as _t,h as $e,L as pt,a6 as we,a3 as et,ac as tt,au as bt,al as oe,a8 as Ee,bb as vt,aw as kt,ak as wt,aC as Et,by as St,B as lt,bq as yt}from"./Commands.5e9f8118.js";import{f as Be,g as Nt}from"./notificationsStore.8de3746c.js";import{c as Se,L as Le,a as Te}from"./colors.78d1fcdd.js";function ze(i){let e,l;return{c(){e=O("title"),l=M(i[1])},l(t){e=F(t,"title",{});var s=b(e);l=I(s,i[1]),s.forEach(d)},m(t,s){y(t,e,s),p(e,l)},p(t,s){s&2&&j(l,t[1])},d(t){t&&d(e)}}}function Ct(i){let e,l,t=i[1]&&ze(i),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:i[0]},{height:i[0]},i[2],i[3]],c={};for(let n=0;n<s.length;n+=1)c=A(c,s[n]);return{c(){e=O("svg"),t&&t.c(),l=O("path"),this.h()},l(n){e=F(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var a=b(e);t&&t.l(a),l=F(a,"path",{d:!0}),b(l).forEach(d),a.forEach(d),this.h()},h(){E(l,"d","M24.59 16.59L17 24.17 17 4 15 4 15 24.17 7.41 16.59 6 18 16 28 26 18 24.59 16.59z"),X(e,c)},m(n,a){y(n,e,a),t&&t.m(e,null),p(e,l)},p(n,[a]){n[1]?t?t.p(n,a):(t=ze(n),t.c(),t.m(e,l)):t&&(t.d(1),t=null),X(e,c=me(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:n[0]},a&1&&{height:n[0]},a&4&&n[2],a&8&&n[3]]))},i:z,o:z,d(n){n&&d(e),t&&t.d()}}}function Ht(i,e,l){let t,s;const c=["size","title"];let n=Y(e,c),{size:a=16}=e,{title:r=void 0}=e;return i.$$set=o=>{l(5,e=A(A({},e),W(o))),l(3,n=Y(e,c)),"size"in o&&l(0,a=o.size),"title"in o&&l(1,r=o.title)},i.$$.update=()=>{l(4,t=e["aria-label"]||e["aria-labelledby"]||r),l(2,s={"aria-hidden":t?void 0:!0,role:t?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=W(e),[a,r,s,n,t]}class Pt extends J{constructor(e){super(),x(this,e,Ht,Ct,$,{size:0,title:1})}}function Me(i){let e,l;return{c(){e=O("title"),l=M(i[1])},l(t){e=F(t,"title",{});var s=b(e);l=I(s,i[1]),s.forEach(d)},m(t,s){y(t,e,s),p(e,l)},p(t,s){s&2&&j(l,t[1])},d(t){t&&d(e)}}}function Vt(i){let e,l,t=i[1]&&Me(i),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:i[0]},{height:i[0]},i[2],i[3]],c={};for(let n=0;n<s.length;n+=1)c=A(c,s[n]);return{c(){e=O("svg"),t&&t.c(),l=O("path"),this.h()},l(n){e=F(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var a=b(e);t&&t.l(a),l=F(a,"path",{d:!0}),b(l).forEach(d),a.forEach(d),this.h()},h(){E(l,"d","M16 4L6 14 7.41 15.41 15 7.83 15 28 17 28 17 7.83 24.59 15.41 26 14 16 4z"),X(e,c)},m(n,a){y(n,e,a),t&&t.m(e,null),p(e,l)},p(n,[a]){n[1]?t?t.p(n,a):(t=Me(n),t.c(),t.m(e,l)):t&&(t.d(1),t=null),X(e,c=me(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:n[0]},a&1&&{height:n[0]},a&4&&n[2],a&8&&n[3]]))},i:z,o:z,d(n){n&&d(e),t&&t.d()}}}function Bt(i,e,l){let t,s;const c=["size","title"];let n=Y(e,c),{size:a=16}=e,{title:r=void 0}=e;return i.$$set=o=>{l(5,e=A(A({},e),W(o))),l(3,n=Y(e,c)),"size"in o&&l(0,a=o.size),"title"in o&&l(1,r=o.title)},i.$$.update=()=>{l(4,t=e["aria-label"]||e["aria-labelledby"]||r),l(2,s={"aria-hidden":t?void 0:!0,role:t?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=W(e),[a,r,s,n,t]}class Lt extends J{constructor(e){super(),x(this,e,Bt,Vt,$,{size:0,title:1})}}function Ie(i){let e,l;return{c(){e=O("title"),l=M(i[1])},l(t){e=F(t,"title",{});var s=b(e);l=I(s,i[1]),s.forEach(d)},m(t,s){y(t,e,s),p(e,l)},p(t,s){s&2&&j(l,t[1])},d(t){t&&d(e)}}}function Tt(i){let e,l,t=i[1]&&Ie(i),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:i[0]},{height:i[0]},i[2],i[3]],c={};for(let n=0;n<s.length;n+=1)c=A(c,s[n]);return{c(){e=O("svg"),t&&t.c(),l=O("path"),this.h()},l(n){e=F(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var a=b(e);t&&t.l(a),l=F(a,"path",{d:!0}),b(l).forEach(d),a.forEach(d),this.h()},h(){E(l,"d","M2 2H7V16H2zM23 2H9V16.8027l3.0422 4.5635.8453 5.9165A2.0094 2.0094 0 0014.8672 29H15a3.0033 3.0033 0 003-3V20h8a4.0045 4.0045 0 004-4V9A7.0078 7.0078 0 0023 2z"),X(e,c)},m(n,a){y(n,e,a),t&&t.m(e,null),p(e,l)},p(n,[a]){n[1]?t?t.p(n,a):(t=Ie(n),t.c(),t.m(e,l)):t&&(t.d(1),t=null),X(e,c=me(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:n[0]},a&1&&{height:n[0]},a&4&&n[2],a&8&&n[3]]))},i:z,o:z,d(n){n&&d(e),t&&t.d()}}}function zt(i,e,l){let t,s;const c=["size","title"];let n=Y(e,c),{size:a=16}=e,{title:r=void 0}=e;return i.$$set=o=>{l(5,e=A(A({},e),W(o))),l(3,n=Y(e,c)),"size"in o&&l(0,a=o.size),"title"in o&&l(1,r=o.title)},i.$$.update=()=>{l(4,t=e["aria-label"]||e["aria-labelledby"]||r),l(2,s={"aria-hidden":t?void 0:!0,role:t?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=W(e),[a,r,s,n,t]}class Mt extends J{constructor(e){super(),x(this,e,zt,Tt,$,{size:0,title:1})}}function Ae(i){let e,l;return{c(){e=O("title"),l=M(i[1])},l(t){e=F(t,"title",{});var s=b(e);l=I(s,i[1]),s.forEach(d)},m(t,s){y(t,e,s),p(e,l)},p(t,s){s&2&&j(l,t[1])},d(t){t&&d(e)}}}function It(i){let e,l,t=i[1]&&Ae(i),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:i[0]},{height:i[0]},i[2],i[3]],c={};for(let n=0;n<s.length;n+=1)c=A(c,s[n]);return{c(){e=O("svg"),t&&t.c(),l=O("path"),this.h()},l(n){e=F(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var a=b(e);t&&t.l(a),l=F(a,"path",{d:!0}),b(l).forEach(d),a.forEach(d),this.h()},h(){E(l,"d","M2 16H7V30H2zM23 30H9V15.1973l3.0422-4.5635.8453-5.9165A2.0094 2.0094 0 0114.8672 3H15a3.0033 3.0033 0 013 3v6h8a4.0045 4.0045 0 014 4v7A7.0078 7.0078 0 0123 30z"),X(e,c)},m(n,a){y(n,e,a),t&&t.m(e,null),p(e,l)},p(n,[a]){n[1]?t?t.p(n,a):(t=Ae(n),t.c(),t.m(e,l)):t&&(t.d(1),t=null),X(e,c=me(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:n[0]},a&1&&{height:n[0]},a&4&&n[2],a&8&&n[3]]))},i:z,o:z,d(n){n&&d(e),t&&t.d()}}}function At(i,e,l){let t,s;const c=["size","title"];let n=Y(e,c),{size:a=16}=e,{title:r=void 0}=e;return i.$$set=o=>{l(5,e=A(A({},e),W(o))),l(3,n=Y(e,c)),"size"in o&&l(0,a=o.size),"title"in o&&l(1,r=o.title)},i.$$.update=()=>{l(4,t=e["aria-label"]||e["aria-labelledby"]||r),l(2,s={"aria-hidden":t?void 0:!0,role:t?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=W(e),[a,r,s,n,t]}class Rt extends J{constructor(e){super(),x(this,e,At,It,$,{size:0,title:1})}}function Dt(i,e){const l=t=>i&&!i.contains(t.target)&&!t.defaultPrevented&&e();return document.addEventListener("click",l,!0),{destroy(){document.removeEventListener("click",l,!0)}}}function Ot(i){let e=(i[1]?"":i[0])+"",l;return{c(){l=M(e)},l(t){l=I(t,e)},m(t,s){y(t,l,s)},p(t,s){s&3&&e!==(e=(t[1]?"":t[0])+"")&&j(l,e)},d(t){t&&d(l)}}}function Ft(i){let e,l,t,s,c;const n=[i[2],{type:"purple"},{icon:Ve}];let a={$$slots:{default:[Ot]},$$scope:{ctx:i}};for(let r=0;r<n.length;r+=1)a=A(a,n[r]);return l=new _t({props:a}),{c(){e=C("div"),le(l.$$.fragment),this.h()},l(r){e=H(r,"DIV",{class:!0});var o=b(e);ie(l.$$.fragment,o),o.forEach(d),this.h()},h(){E(e,"class","embedding-badge truncate"),R(e,"embedding-badge-nolabel",i[1])},m(r,o){y(r,e,o),ne(l,e,null),t=!0,s||(c=de($e.call(null,e,{text:"Embedding index"})),s=!0)},p(r,[o]){const u=o&4?me(n,[o&4&&ct(r[2]),n[1],o&0&&{icon:Ve}]):{};o&11&&(u.$$scope={dirty:o,ctx:r}),l.$set(u),(!t||o&2)&&R(e,"embedding-badge-nolabel",r[1])},i(r){t||(S(l.$$.fragment,r),t=!0)},o(r){N(l.$$.fragment,r),t=!1},d(r){r&&d(e),se(l),s=!1,c()}}}function Ut(i,e,l){const t=["embedding","hideEmbeddingName"];let s=Y(e,t),{embedding:c}=e,{hideEmbeddingName:n=!1}=e;return i.$$set=a=>{e=A(A({},e),W(a)),l(2,s=Y(e,t)),"embedding"in a&&l(0,c=a.embedding),"hideEmbeddingName"in a&&l(1,n=a.hideEmbeddingName)},[c,n,s]}class Yt extends J{constructor(e){super(),x(this,e,Ut,Ft,$,{embedding:0,hideEmbeddingName:1})}}function Re(i,e,l){const t=i.slice();return t[12]=e[l],t}function De(i){let e,l,t=i[0].conceptNamespace+"",s,c,n=i[0].conceptName+"",a,r,o,u,f,g,m,k,_,w,v;return f=new Rt({}),k=new Mt({}),{c(){e=C("div"),l=C("div"),s=M(t),c=M(" / "),a=M(n),r=G(),o=C("div"),u=C("button"),le(f.$$.fragment),g=G(),m=C("button"),le(k.$$.fragment),this.h()},l(V){e=H(V,"DIV",{class:!0});var P=b(e);l=H(P,"DIV",{class:!0});var L=b(l);s=I(L,t),c=I(L," / "),a=I(L,n),L.forEach(d),r=K(P),o=H(P,"DIV",{class:!0});var T=b(o);u=H(T,"BUTTON",{class:!0});var U=b(u);ie(f.$$.fragment,U),U.forEach(d),g=K(T),m=H(T,"BUTTON",{class:!0});var ee=b(m);ie(k.$$.fragment,ee),ee.forEach(d),T.forEach(d),P.forEach(d),this.h()},h(){E(l,"class","flex-grow"),E(u,"class","p-1"),E(m,"class","p-1"),E(o,"class","shrink-0"),E(e,"class","flex flex-row items-center justify-between gap-x-4 p-2")},m(V,P){y(V,e,P),p(e,l),p(l,s),p(l,c),p(l,a),p(e,r),p(e,o),p(o,u),ne(f,u,null),p(o,g),p(o,m),ne(k,m,null),_=!0,w||(v=[he(u,"click",i[8]),he(m,"click",i[9])],w=!0)},p(V,P){(!_||P&1)&&t!==(t=V[0].conceptNamespace+"")&&j(s,t),(!_||P&1)&&n!==(n=V[0].conceptName+"")&&j(a,n)},i(V){_||(S(f.$$.fragment,V),S(k.$$.fragment,V),_=!0)},o(V){N(f.$$.fragment,V),N(k.$$.fragment,V),_=!1},d(V){V&&d(e),se(f),se(k),w=!1,Je(v)}}}function Oe(i){let e,l=[],t=new Map,s,c=i[2];const n=a=>a[12];for(let a=0;a<c.length;a+=1){let r=Re(i,c,a),o=n(r);t.set(o,l[a]=Fe(o,r))}return{c(){e=C("div");for(let a=0;a<l.length;a+=1)l[a].c();this.h()},l(a){e=H(a,"DIV",{class:!0});var r=b(e);for(let o=0;o<l.length;o+=1)l[o].l(r);r.forEach(d),this.h()},h(){E(e,"class","more-button flex flex-col")},m(a,r){y(a,e,r);for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(e,null);s=!0},p(a,r){r&29&&(c=a[2],Q(),l=xe(l,r,n,1,a,c,t,e,ft,Fe,null,Re),Z())},i(a){if(!s){for(let r=0;r<c.length;r+=1)S(l[r]);s=!0}},o(a){for(let r=0;r<l.length;r+=1)N(l[r]);s=!1},d(a){a&&d(e);for(let r=0;r<l.length;r+=1)l[r].d()}}}function Fe(i,e){let l,t,s,c,n,a,r,o,u;n=new Yt({props:{class:"hover:cursor-pointer",embedding:e[12]}});function f(){return e[10](e[12])}return{key:i,first:null,c(){l=C("button"),t=C("div"),s=M("Find similar"),c=G(),le(n.$$.fragment),a=G(),this.h()},l(g){l=H(g,"BUTTON",{class:!0});var m=b(l);t=H(m,"DIV",{});var k=b(t);s=I(k,"Find similar"),k.forEach(d),c=K(m),ie(n.$$.fragment,m),a=K(m),m.forEach(d),this.h()},h(){E(l,"class","flex w-full items-center justify-between"),this.first=l},m(g,m){y(g,l,m),p(l,t),p(t,s),p(l,c),ne(n,l,null),p(l,a),r=!0,o||(u=he(l,"click",f),o=!0)},p(g,m){e=g;const k={};m&4&&(k.embedding=e[12]),n.$set(k)},i(g){r||(S(n.$$.fragment,g),r=!0)},o(g){N(n.$$.fragment,g),r=!1},d(g){g&&d(l),se(n),o=!1,u()}}}function jt(i){let e,l,t,s,c,n,a,r=i[0].conceptName!=null&&i[0].conceptNamespace!=null&&De(i),o=i[3]!=null&&Oe(i);return{c(){e=C("div"),r&&r.c(),l=G(),o&&o.c(),this.h()},l(u){e=H(u,"DIV",{style:!0,class:!0});var f=b(e);r&&r.l(f),l=K(f),o&&o.l(f),f.forEach(d),this.h()},h(){E(e,"style",t=i[1]!=null?`left: ${i[1].x}px; top: ${i[1].y}px`:""),E(e,"class","absolute z-10 inline-flex -translate-x-1/2 translate-y-6 flex-col divide-y divide-gray-200 rounded border border-gray-200 bg-white shadow")},m(u,f){y(u,e,f),r&&r.m(e,null),p(e,l),o&&o.m(e,null),c=!0,n||(a=de(Dt.call(null,e,i[11])),n=!0)},p(u,[f]){u[0].conceptName!=null&&u[0].conceptNamespace!=null?r?(r.p(u,f),f&1&&S(r,1)):(r=De(u),r.c(),S(r,1),r.m(e,l)):r&&(Q(),N(r,1,1,()=>{r=null}),Z()),u[3]!=null?o?(o.p(u,f),f&8&&S(o,1)):(o=Oe(u),o.c(),S(o,1),o.m(e,null)):o&&(Q(),N(o,1,1,()=>{o=null}),Z()),(!c||f&2&&t!==(t=u[1]!=null?`left: ${u[1].x}px; top: ${u[1].y}px`:""))&&E(e,"style",t)},i(u){c||(S(r),S(o),Ze(()=>{c&&(s||(s=Ne(e,Be,{duration:60},!0)),s.run(1))}),c=!0)},o(u){N(r),N(o),s||(s=Ne(e,Be,{duration:60},!1)),s.run(0),c=!1},d(u){u&&d(e),r&&r.d(),o&&o.d(),u&&s&&s.end(),n=!1,a()}}}function qt(i,e,l){let{details:t}=e,{clickPosition:s}=e,{embeddings:c}=e,{addConceptLabel:n}=e,{findSimilar:a}=e,{addNotification:r}=e;const o=ut();function u(_){if(!t.conceptName||!t.conceptNamespace)throw Error("Label could not be added, no active concept.");n(t.conceptNamespace,t.conceptName,t.text,_),r({kind:"success",title:`[${_===!0?"Positive":"Negative"}] Concept label added`,subtitle:pt(t.conceptNamespace,t.conceptName),message:t.text}),o("click")}const f=()=>u(!0),g=()=>u(!1),m=_=>{a&&a(_,t.text),o("click")},k=()=>o("close");return i.$$set=_=>{"details"in _&&l(0,t=_.details),"clickPosition"in _&&l(1,s=_.clickPosition),"embeddings"in _&&l(2,c=_.embeddings),"addConceptLabel"in _&&l(6,n=_.addConceptLabel),"findSimilar"in _&&l(3,a=_.findSimilar),"addNotification"in _&&l(7,r=_.addNotification)},[t,s,c,a,o,u,n,r,f,g,m,k]}class Wt extends J{constructor(e){super(),x(this,e,qt,jt,$,{details:0,clickPosition:1,embeddings:2,addConceptLabel:6,findSimilar:3,addNotification:7})}}function Xt(i,e){let l,t=e;i.addEventListener("click",n=>s(n));function s(n){t.disabled||(l=new Wt({props:{details:t.details(),clickPosition:{x:n.clientX,y:n.clientY},embeddings:t.embeddings,addConceptLabel:t.addConceptLabel,addNotification:t.addNotification,findSimilar:t.findSimilar},target:document.body}),l.$on("close",c),l.$on("click",c))}function c(){l==null||l.$destroy(),l=void 0}return{update(n){t=n,l==null||l.$set({details:t.details()})},destroy(){c()}}}function Ue(i,e,l){const t=i.slice();return t[7]=e[l],t}function Ye(i,e){let l,t,s=e[7].info.name+"",c,n,a,r,o=je(e[7])+"",u,f;return{key:i,first:null,c(){l=C("div"),t=C("div"),c=M(s),n=G(),a=C("div"),r=C("span"),u=M(o),f=G(),this.h()},l(g){l=H(g,"DIV",{class:!0});var m=b(l);t=H(m,"DIV",{class:!0});var k=b(t);c=I(k,s),k.forEach(d),n=K(m),a=H(m,"DIV",{class:!0});var _=b(a);r=H(_,"SPAN",{class:!0});var w=b(r);u=I(w,o),w.forEach(d),_.forEach(d),f=K(m),m.forEach(d),this.h()},h(){E(t,"class","named-value-name table-cell max-w-xs truncate pr-2 svelte-1689hje"),E(r,"class","px-1"),R(r,"font-bold",e[7].info.type==="keyword"||e[7].info.type==="metadata"&&!we(e[7].info.dtype)),q(r,"background-color",(e[7].info.type==="concept_score"||e[7].info.type==="semantic_similarity")&&typeof e[7].value=="number"?Se(e[7].value):""),E(a,"class","table-cell rounded text-right"),E(l,"class","table-row"),this.first=l},m(g,m){y(g,l,m),p(l,t),p(t,c),p(l,n),p(l,a),p(a,r),p(r,u),p(l,f)},p(g,m){e=g,m&1&&s!==(s=e[7].info.name+"")&&j(c,s),m&1&&o!==(o=je(e[7])+"")&&j(u,o),m&1&&R(r,"font-bold",e[7].info.type==="keyword"||e[7].info.type==="metadata"&&!we(e[7].info.dtype)),m&1&&q(r,"background-color",(e[7].info.type==="concept_score"||e[7].info.type==="semantic_similarity")&&typeof e[7].value=="number"?Se(e[7].value):"")},d(g){g&&d(l)}}}function Gt(i){let e,l,t=[],s=new Map,c,n=`${i[4]}px`,a=`${Math.min(i[1],i[3]-i[2]-20)}px`,r=i[0];const o=u=>u[7];for(let u=0;u<r.length;u+=1){let f=Ue(i,r,u),g=o(f);s.set(g,t[u]=Ye(g,f))}return{c(){e=C("div"),l=C("div");for(let u=0;u<t.length;u+=1)t[u].c();this.h()},l(u){e=H(u,"DIV",{role:!0,class:!0});var f=b(e);l=H(f,"DIV",{class:!0});var g=b(l);for(let m=0;m<t.length;m+=1)t[m].l(g);g.forEach(d),f.forEach(d),this.h()},h(){E(l,"class","table border-spacing-y-2"),E(e,"role","tooltip"),E(e,"class","absolute max-w-fit -translate-y-full break-words border border-gray-300 bg-white px-2 shadow-md"),Ze(()=>i[6].call(e)),R(e,"hidden",i[0].length===0),q(e,"top",n),q(e,"left",a)},m(u,f){y(u,e,f),p(e,l);for(let g=0;g<t.length;g+=1)t[g]&&t[g].m(l,null);c=dt(e,i[6].bind(e))},p(u,[f]){f&1&&(r=u[0],t=xe(t,f,o,1,u,r,s,l,ht,Ye,null,Ue)),f&1&&R(e,"hidden",u[0].length===0),f&6&&a!==(a=`${Math.min(u[1],u[3]-u[2]-20)}px`)&&q(e,"left",a)},i:z,o:z,d(u){u&&d(e);for(let f=0;f<t.length;f+=1)t[f].d();c()}}}function je(i){return typeof i.value=="number"?i.value.toFixed(3):i.info.dtype==="string_span"?"true":i.value}function Kt(i,e,l){let{namedValues:t}=e,{x:s}=e,{y:c}=e;const n=window.innerWidth;let a=0;const r=c-1;function o(){a=this.clientWidth,l(2,a)}return i.$$set=u=>{"namedValues"in u&&l(0,t=u.namedValues),"x"in u&&l(1,s=u.x),"y"in u&&l(5,c=u.y)},[t,s,a,n,r,c,o]}class Qt extends J{constructor(e){super(),x(this,e,Kt,Gt,$,{namedValues:0,x:1,y:5})}}function Zt(i,e){let l,t=e;const s=()=>n();t.isHovered&&c();function c(){const a=t.namedValues.filter(g=>Array.from(t.spansHovered).some(m=>{const k=et(m);return tt(g.specificPath.slice(0,k.length),k)}));t.itemScrollContainer!=null&&t.itemScrollContainer.addEventListener("scroll",s);const r=i.getBoundingClientRect(),o=window.getComputedStyle(i),u=parseInt(o.getPropertyValue("line-height")),f=r.height>u?r.x+i.offsetLeft||i.clientLeft:r.x;l=new Qt({props:{namedValues:a,x:f,y:r.top},target:document.body})}function n(){var a;l==null||l.$destroy(),(a=t.itemScrollContainer)==null||a.removeEventListener("scroll",s)}return{update(a){n(),t=a,t.isHovered&&c()},destroy(){n()}}}const qe=300,be=50;function Jt(i,e,l){const t=[],s=new Set;for(const c of i){let n=!1;const a=[];for(const v of c.paths)s.has(v)||(a.push(v),s.add(v));const r=[],o=[];let u=-1/0;for(const[v,V]of Object.entries(c.originalSpans)){const P=e[v],L=et(v);if(!(P==null||P.length===0))for(const T of V)for(const U of P){const ee=U.path.slice(L.length),D=bt(T,ee);if(D==null)continue;const ae=oe.value(D),ge=oe.span(D);if(ae==null&&ge==null)continue;if(U.dtype==="float32"){const _e=oe.value(D);_e!=null&&(u=Math.max(u,_e))}const ve=Ee(oe.path(T)),te=!a.includes(ve),re={value:ae,info:U,specificPath:oe.path(D)};te||r.push(re),o.push(re),U.type==="concept_score"||U.type==="semantic_similarity"?ae>.5&&(n=!0):n=!0}}const f=o.some(v=>v.info.type==="label"),g=o.some(v=>v.info.type==="leaf_span"),m=o.some(v=>v.info.type==="keyword"),k=o.some(v=>v.info.type==="metadata"&&!we(v.info.dtype)),_=c.paths.some(v=>l.has(v)),w=_&&a.length>0&&Array.from(l).some(v=>a.includes(v));t.push({backgroundColor:Se(u),isBlackBolded:m||k||g,isHighlightBolded:f,isHighlighted:n,snippetScore:u,namedValues:r,paths:c.paths,text:c.text,originalSpans:c.originalSpans,isHovered:_,isFirstHover:w})}return t}function xt(i,e){var c;if(e)return{snippetSpans:i.map(n=>({renderSpan:n,snippetText:n.text})),someSnippetsHidden:!1};let l=!1,t=!1,s=[];for(let n=0;n<i.length;n++){const a=i[n],r=n-1>=0?i[n-1]:null,o=n+1<i.length?i[n+1]:null,u=(c=s.at(-1))==null?void 0:c.isEllipsis;if(!a.isHighlighted){if(u||r!=null&&r.isHighlighted||o!=null&&o.isHighlighted)continue;l=!0,s.push({isEllipsis:!0});continue}t=!0,r!=null&&!r.isHighlighted&&(!u&&r.text.length>be&&(s.push({isEllipsis:!0}),l=!0),s.push({renderSpan:r,snippetText:r.text.slice(-be)})),s.push({renderSpan:a,snippetText:a.text}),o!=null&&!o.isHighlighted&&(s.push({renderSpan:o,snippetText:o.text.slice(0,be)}),!u&&o.text.length>be&&(s.push({isEllipsis:!0}),l=!0))}return t||(s=[],l=!1,s.push({renderSpan:i[0],snippetText:i[0].text.slice(0,qe)}),((i[1]||null)!=null||i[0].text.length>qe)&&(s.push({isEllipsis:!0}),l=!0)),{snippetSpans:s,someSnippetsHidden:l}}function We(i,e,l){const t=i.slice();return t[34]=e[l],t}function $t(i){const e=i.slice(),l=e[34].renderSpan;return e[37]=l,e}function el(i){let e,l,t,s;return{c(){e=C("span"),l=M("..."),this.h()},l(c){e=H(c,"SPAN",{class:!0});var n=b(e);l=I(n,"..."),n.forEach(d),this.h()},h(){E(e,"class","highlight-span text-sm leading-5 svelte-10l1gaq")},m(c,n){y(c,e,n),p(e,l),t||(s=de($e.call(null,e,{text:`Some text was hidden to improve readability. 
Click "Show all" to show the entire document.`})),t=!0)},p:z,i:z,o:z,d(c){c&&d(e),t=!1,s()}}}function tl(i){let e,l,t,s,c,n,a,r;const o=[il,ll],u=[];function f(_,w){return _[1]?0:1}l=f(i),t=u[l]=o[l](i);function g(){return i[28](i[37])}function m(){return i[29](i[37])}function k(){return i[30](i[37])}return{c(){e=C("span"),t.c(),this.h()},l(_){e=H(_,"SPAN",{class:!0});var w=b(e);t.l(w),w.forEach(d),this.h()},h(){E(e,"class","hover:cursor-poiner highlight-span break-words text-sm leading-5 svelte-10l1gaq"),R(e,"highlighted",i[37].isHighlighted),R(e,"hover:cursor-pointer",i[0].length>0),R(e,"font-bold",i[37].isBlackBolded),R(e,"font-medium",i[37].isHighlightBolded&&!i[37].isBlackBolded),q(e,"color",i[37].isHighlightBolded&&!i[37].isBlackBolded?Le:""),q(e,"background-color",i[37].isHovered?Te(Ke):i[37].backgroundColor)},m(_,w){y(_,e,w),u[l].m(e,null),n=!0,a||(r=[de(s=Zt.call(null,e,{namedValues:i[37].namedValues,isHovered:i[37].isFirstHover,spansHovered:i[4],itemScrollContainer:i[8]})),de(c=Xt.call(null,e,{details:g,findSimilar:i[3]!=null?i[15]:null,embeddings:i[2],addConceptLabel:i[13],addNotification:i[16]!=null?i[16].addNotification:Qe,disabled:i[37].paths.length===0||i[2].length===0})),he(e,"mouseenter",m),he(e,"mouseleave",k)],a=!0)},p(_,w){i=_;let v=l;l=f(i),l===v?u[l].p(i,w):(Q(),N(u[v],1,1,()=>{u[v]=null}),Z(),t=u[l],t?t.p(i,w):(t=u[l]=o[l](i),t.c()),S(t,1),t.m(e,null)),s&&Pe(s.update)&&w[0]&400&&s.update.call(null,{namedValues:i[37].namedValues,isHovered:i[37].isFirstHover,spansHovered:i[4],itemScrollContainer:i[8]}),c&&Pe(c.update)&&w[0]&140&&c.update.call(null,{details:g,findSimilar:i[3]!=null?i[15]:null,embeddings:i[2],addConceptLabel:i[13],addNotification:i[16]!=null?i[16].addNotification:Qe,disabled:i[37].paths.length===0||i[2].length===0}),(!n||w[0]&128)&&R(e,"highlighted",i[37].isHighlighted),(!n||w[0]&1)&&R(e,"hover:cursor-pointer",i[0].length>0),(!n||w[0]&128)&&R(e,"font-bold",i[37].isBlackBolded),(!n||w[0]&128)&&R(e,"font-medium",i[37].isHighlightBolded&&!i[37].isBlackBolded),w[0]&128&&q(e,"color",i[37].isHighlightBolded&&!i[37].isBlackBolded?Le:""),w[0]&128&&q(e,"background-color",i[37].isHovered?Te(Ke):i[37].backgroundColor)},i(_){n||(S(t),n=!0)},o(_){N(t),n=!1},d(_){_&&d(e),u[l].d(),a=!1,Je(r)}}}function ll(i){let e=i[34].snippetText+"",l;return{c(){l=M(e)},l(t){l=I(t,e)},m(t,s){y(t,l,s)},p(t,s){s[0]&128&&e!==(e=t[34].snippetText+"")&&j(l,e)},i:z,o:z,d(t){t&&d(l)}}}function il(i){let e,l;return e=new yt({props:{source:i[34].snippetText}}),{c(){le(e.$$.fragment)},l(t){ie(e.$$.fragment,t)},m(t,s){ne(e,t,s),l=!0},p(t,s){const c={};s[0]&128&&(c.source=t[34].snippetText),e.$set(c)},i(t){l||(S(e.$$.fragment,t),l=!0)},o(t){N(e.$$.fragment,t),l=!1},d(t){se(e,t)}}}function Xe(i){let e,l,t,s;const c=[tl,el],n=[];function a(o,u){return o[34].isEllipsis?1:0}function r(o,u){return u===0?$t(o):o}return e=a(i),l=n[e]=c[e](r(i,e)),{c(){l.c(),t=He()},l(o){l.l(o),t=He()},m(o,u){n[e].m(o,u),y(o,t,u),s=!0},p(o,u){let f=e;e=a(o),e===f?n[e].p(r(o,e),u):(Q(),N(n[f],1,1,()=>{n[f]=null}),Z(),l=n[e],l?l.p(r(o,e),u):(l=n[e]=c[e](r(o,e)),l.c()),S(l,1),l.m(t.parentNode,t))},i(o){s||(S(l),s=!0)},o(o){N(l),s=!1},d(o){n[e].d(o),o&&d(t)}}}function Ge(i){let e,l,t,s,c;const n=[sl,nl],a=[];function r(o,u){return o[5]?1:0}return t=r(i),s=a[t]=n[t](i),{c(){e=C("div"),l=C("div"),s.c(),this.h()},l(o){e=H(o,"DIV",{class:!0});var u=b(e);l=H(u,"DIV",{class:!0});var f=b(l);s.l(f),f.forEach(d),u.forEach(d),this.h()},h(){E(l,"class","w-30 mt-2 rounded border border-neutral-300 text-center"),E(e,"class","flex flex-row justify-center")},m(o,u){y(o,e,u),p(e,l),a[t].m(l,null),c=!0},p(o,u){let f=t;t=r(o),t===f?a[t].p(o,u):(Q(),N(a[f],1,1,()=>{a[f]=null}),Z(),s=a[t],s?s.p(o,u):(s=a[t]=n[t](o),s.c()),S(s,1),s.m(l,null))},i(o){c||(S(s),c=!0)},o(o){N(s),c=!1},d(o){o&&d(e),a[t].d()}}}function nl(i){let e,l;return e=new lt({props:{size:"small",class:"w-full",kind:"ghost",icon:Lt,$$slots:{default:[al]},$$scope:{ctx:i}}}),e.$on("click",i[32]),{c(){le(e.$$.fragment)},l(t){ie(e.$$.fragment,t)},m(t,s){ne(e,t,s),l=!0},p(t,s){const c={};s[1]&128&&(c.$$scope={dirty:s,ctx:t}),e.$set(c)},i(t){l||(S(e.$$.fragment,t),l=!0)},o(t){N(e.$$.fragment,t),l=!1},d(t){se(e,t)}}}function sl(i){let e,l;return e=new lt({props:{size:"small",class:"w-full",kind:"ghost",icon:Pt,$$slots:{default:[ol]},$$scope:{ctx:i}}}),e.$on("click",i[31]),{c(){le(e.$$.fragment)},l(t){ie(e.$$.fragment,t)},m(t,s){ne(e,t,s),l=!0},p(t,s){const c={};s[1]&128&&(c.$$scope={dirty:s,ctx:t}),e.$set(c)},i(t){l||(S(e.$$.fragment,t),l=!0)},o(t){N(e.$$.fragment,t),l=!1},d(t){se(e,t)}}}function al(i){let e;return{c(){e=M("Hide excess")},l(l){e=I(l,"Hide excess")},m(l,t){y(l,e,t)},d(l){l&&d(e)}}}function ol(i){let e;return{c(){e=M("Show all")},l(l){e=I(l,"Show all")},m(l,t){y(l,e,t)},d(l){l&&d(e)}}}function rl(i){let e,l,t,s=i[7],c=[];for(let r=0;r<s.length;r+=1)c[r]=Xe(We(i,s,r));const n=r=>N(c[r],1,1,()=>{c[r]=null});let a=(i[6]||i[5])&&Ge(i);return{c(){e=C("div");for(let r=0;r<c.length;r+=1)c[r].c();l=G(),a&&a.c(),this.h()},l(r){e=H(r,"DIV",{class:!0});var o=b(e);for(let u=0;u<c.length;u+=1)c[u].l(o);l=K(o),a&&a.l(o),o.forEach(d),this.h()},h(){E(e,"class","relative overflow-x-hidden text-ellipsis whitespace-break-spaces")},m(r,o){y(r,e,o);for(let u=0;u<c.length;u+=1)c[u]&&c[u].m(e,null);p(e,l),a&&a.m(e,null),t=!0},p(r,o){if(o[0]&110495){s=r[7];let u;for(u=0;u<s.length;u+=1){const f=We(r,s,u);c[u]?(c[u].p(f,o),S(c[u],1)):(c[u]=Xe(f),c[u].c(),S(c[u],1),c[u].m(e,l))}for(Q(),u=s.length;u<c.length;u+=1)n(u);Z()}r[6]||r[5]?a?(a.p(r,o),o[0]&96&&S(a,1)):(a=Ge(r),a.c(),S(a,1),a.m(e,null)):a&&(Q(),N(a,1,1,()=>{a=null}),Z())},i(r){if(!t){for(let o=0;o<s.length;o+=1)S(c[o]);S(a),t=!0}},o(r){c=c.filter(Boolean);for(let o=0;o<c.length;o+=1)N(c[o]);N(a),t=!1},d(r){r&&d(e),mt(c,r),a&&a.d()}}}const Ke=.9,Qe=()=>null;function cl(i,e,l){let t,s,c,n,a,r,{text:o}=e,{row:u}=e,{field:f=void 0}=e,{spanPaths:g}=e,{path:m=void 0}=e,{valuePaths:k}=e,{markdown:_=!1}=e,{embeddings:w}=e,{datasetViewStore:v=void 0}=e,{datasetStore:V=void 0}=e,P,L={},T=new Set;const U=h=>{h.paths.forEach(B=>T.add(B)),l(4,T)},ee=h=>{h.paths.forEach(B=>T.delete(B)),l(4,T)};let D={};const ae=h=>{const ce={conceptName:null,conceptNamespace:null,text:s.filter(ue=>ue.paths.some(ke=>((h==null?void 0:h.paths)||[]).some(fe=>tt(fe,ke)))).map(ue=>ue.text).join("")};for(const ue of Object.keys(h.originalSpans)){const ke=(L[ue]||[]).filter(fe=>fe.type==="concept_score");for(const fe of ke){const ye=fe.signal;ce.conceptName=ye.concept_name,ce.conceptNamespace=ye.namespace;break}}return ce},ge=vt();Ce(i,ge,h=>l(33,a=h));const ve=(h,B,pe,ce)=>{if(!B||!h)throw Error("Label could not be added, no active concept.");a.mutate([h,B,{insert:[{text:pe,label:ce}]}])};let te=!1,re=gt(kt);Ce(i,re,h=>l(8,r=h));const _e=(h,B)=>{v==null||f==null||v.addSearch({path:f.path,type:"semantic",query:B,embedding:h})},it=Nt(),nt=h=>ae(h),st=h=>U(h),at=h=>ee(h),ot=()=>l(5,te=!0),rt=()=>l(5,te=!1);return i.$$set=h=>{"text"in h&&l(17,o=h.text),"row"in h&&l(18,u=h.row),"field"in h&&l(19,f=h.field),"spanPaths"in h&&l(0,g=h.spanPaths),"path"in h&&l(20,m=h.path),"valuePaths"in h&&l(21,k=h.valuePaths),"markdown"in h&&l(1,_=h.markdown),"embeddings"in h&&l(2,w=h.embeddings),"datasetViewStore"in h&&l(22,v=h.datasetViewStore),"datasetStore"in h&&l(3,V=h.datasetStore)},i.$$.update=()=>{if(i.$$.dirty[0]&1310721&&(l(23,P={}),g.forEach(h=>{const B=wt(u,h);l(23,P[Ee(h)]=B.filter(pe=>Et(oe.path(pe),m)||m==null),P)})),i.$$.dirty[0]&18874368){l(24,L={});for(const h of k){const B=Ee(h.spanPath);L[B]==null&&l(24,L[B]=[],L),L[B].push(h)}}if(i.$$.dirty[0]&8519680&&l(27,t=St(o,P)),i.$$.dirty[0]&150994960&&l(26,s=Jt(t,L,T)),i.$$.dirty[0]&167772160){l(25,D={});for(const h of t)for(const B of h.paths)l(25,D[B]=D[B]||[],D),D[B].push(h)}i.$$.dirty[0]&67108896&&l(7,{snippetSpans:c,someSnippetsHidden:n}=xt(s,te),c,(l(6,n),l(26,s),l(5,te),l(27,t),l(24,L),l(4,T),l(17,o),l(23,P),l(21,k),l(0,g),l(18,u),l(20,m)))},[g,_,w,V,T,te,n,c,r,U,ee,ae,ge,ve,re,_e,it,o,u,f,m,k,v,P,L,D,s,t,nt,st,at,ot,rt]}class ml extends J{constructor(e){super(),x(this,e,cl,rl,$,{text:17,row:18,field:19,spanPaths:0,path:20,valuePaths:21,markdown:1,embeddings:2,datasetViewStore:22,datasetStore:3},null,[-1,-1])}}export{Yt as E,ml as S,Rt as T,Mt as a,Dt as c};
